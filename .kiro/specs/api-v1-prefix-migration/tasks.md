# 实施计划：API v1 前缀迁移

## 概述

本实施计划将系统地更新所有 API 端点路径，在每个路径前添加 `/v1` 版本前缀。迁移分为两个主要部分：
1. 更新 `.env.staging` 环境配置文件
2. 更新 `src/api/v1/` 目录下所有 TypeScript 文件中的 API 端点路径

## 任务

- [x] 1. 更新环境配置文件
  - 在 `.env.staging` 文件中添加 `VITE_APP_API_URL = "{scheme}//api.{domain}"` 配置
  - 确保配置值不包含 `/v1` 后缀
  - 验证其他环境变量保持不变
  - _需求: 1.1, 1.2, 1.3_

- [ ]* 1.1 为环境配置编写单元测试
  - 测试 `.env.staging` 包含正确的 `VITE_APP_API_URL`
  - 测试配置值为 `{scheme}//api.{domain}`
  - _需求: 1.1, 1.2_

- [x] 2. 更新核心 API 服务文件（第一批）
  - [x] 2.1 更新 `src/api/v1/auth.ts` 中的所有 API 路径
    - 为所有端点路径添加 `/v1` 前缀
    - 保持请求配置的其他部分不变
    - _需求: 2.1, 2.2, 2.6, 2.7_

  - [x] 2.2 更新 `src/api/v1/user.ts` 中的所有 API 路径
    - 为所有端点路径添加 `/v1` 前缀
    - _需求: 2.1, 2.2, 2.6_

  - [x] 2.3 更新 `src/api/v1/email.ts` 中的所有 API 路径
    - 为所有端点路径添加 `/v1` 前缀
    - _需求: 2.1, 2.2, 2.6_

- [ ]* 2.4 为路径转换编写属性测试
  - **属性 1: 所有 API 端点都有 v1 前缀**
  - **验证需求: 2.1, 2.2, 2.6, 4.1**

- [ ]* 2.5 为路径转换编写单元测试
  - 测试 `/auth/login` → `/v1/auth/login`
  - 测试 `/user/info` → `/v1/user/info`
  - 测试 `/email/send-verification` → `/v1/email/send-verification`
  - 测试幂等性：`/v1/auth/login` 保持不变
  - _需求: 2.3, 2.4, 2.5, 4.3_

- [x] 3. 更新元宇宙相关 API 文件（第二批）
  - [x] 3.1 更新 `src/api/v1/meta.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 3.2 更新 `src/api/v1/meta-verse.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 3.3 更新 `src/api/v1/meta-resource.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 3.4 更新 `src/api/v1/verse.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 3.5 更新 `src/api/v1/multilanguage-verse.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 3.6 更新 `src/api/v1/multilanguage-verses.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 4. 更新教育相关 API 文件（第三批）
  - [x] 4.1 更新 `src/api/v1/edu-class.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 4.2 更新 `src/api/v1/edu-school.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 4.3 更新 `src/api/v1/edu-student.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 4.4 更新 `src/api/v1/edu-teacher.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 5. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 6. 更新社交和内容相关 API 文件（第四批）
  - [x] 6.1 更新 `src/api/v1/message.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 6.2 更新 `src/api/v1/like.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 6.3 更新 `src/api/v1/reply.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 6.4 更新 `src/api/v1/group.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 6.5 更新 `src/api/v1/person.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 7. 更新资源和文件相关 API 文件（第五批）
  - [x] 7.1 更新 `src/api/v1/files.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 7.2 更新 `src/api/v1/upload.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 7.3 更新 `src/api/v1/prefab.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 7.4 更新 `src/api/v1/phototype.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 8. 更新工具和第三方集成 API 文件（第六批）
  - [x] 8.1 更新 `src/api/v1/tools.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 8.2 更新 `src/api/v1/ai-rodin.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 8.3 更新 `src/api/v1/tencent-cloud.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 8.4 更新 `src/api/v1/wechat.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 9. 更新其他 API 文件（第七批）
  - [x] 9.1 更新 `src/api/v1/domain.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 9.2 更新 `src/api/v1/site.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 9.3 更新 `src/api/v1/tags.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 9.4 更新 `src/api/v1/cyber.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 9.5 更新 `src/api/v1/vp-guide.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

  - [x] 9.6 更新 `src/api/v1/vp-map.ts` 中的所有 API 路径
    - _需求: 2.1, 2.2, 2.6_

- [x] 10. 更新子目录中的 API 文件
  - [x] 10.1 列出并更新 `src/api/v1/resources/` 目录下的所有 TypeScript 文件
    - 为每个文件中的所有 API 路径添加 `/v1` 前缀
    - _需求: 2.1, 2.2, 2.6, 3.2_

  - [x] 10.2 列出并更新 `src/api/v1/types/` 目录下的所有 TypeScript 文件
    - 为每个文件中的所有 API 路径添加 `/v1` 前缀（如果包含 API 调用）
    - _需求: 2.1, 2.2, 2.6, 3.3_

- [ ]* 10.3 为文件覆盖率编写属性测试
  - **属性 3: 完整的文件覆盖**
  - **验证需求: 3.1, 3.2, 3.3**

- [ ]* 10.4 为每个文件的所有端点更新编写属性测试
  - **属性 4: 每个文件的所有端点都已更新**
  - **验证需求: 3.4**

- [x] 11. 检查点 - 验证动态内容保留
  - 确保所有测试通过，如有问题请询问用户

- [ ]* 11.1 为动态内容保留编写属性测试
  - **属性 5: 动态内容保留**
  - 测试模板字面量（如 `${id}`）保持不变
  - 测试查询字符串构建器（如 `${qs.stringify(...)}`）保持不变
  - **验证需求: 4.4, 4.5**

- [ ]* 11.2 为 URL 格式验证编写属性测试
  - **属性 6: 没有格式错误的 URL**
  - 测试结果中没有双斜杠（如 `/v1//auth`）
  - **验证需求: 4.2**

- [ ]* 11.3 为幂等性编写属性测试
  - **属性 7: 转换幂等性**
  - 测试已有 `/v1/` 前缀的路径保持不变
  - **验证需求: 4.3**

- [x] 12. 代码质量验证
  - [x] 12.1 运行 TypeScript 编译器验证所有文件
    - 确保没有新的编译错误
    - _需求: 5.5_

  - [ ]* 12.2 为代码结构保留编写属性测试
    - **属性 8: 代码结构保留**
    - 验证类型注解、导入语句、注释、函数签名保持不变
    - **验证需求: 5.1, 5.2, 5.3, 5.4**

  - [ ]* 12.3 为 TypeScript 编译有效性编写属性测试
    - **属性 9: TypeScript 编译有效性**
    - 验证所有修改的文件都能通过编译
    - **验证需求: 5.5**

- [x] 13. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以更快实现 MVP
- 每个任务都引用了具体的需求以便追溯
- 检查点确保增量验证
- 属性测试验证通用的正确性属性
- 单元测试验证具体示例和边界情况
