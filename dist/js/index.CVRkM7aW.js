import{d as e,bo as a,X as s,r as t,e as l,h as i,B as r,l as d,w as n,aZ as o,D as c,a1 as p,Q as u,R as m,k as f,a0 as v,aw as y}from"./index.D_6c1BO-.js";import{E as x}from"./el-divider.CDnQysLO.js";import{E as g}from"./el-progress.LtfRqGX4.js";import{p as w}from"./files.D66WF0_8.js";const h={class:"document-index"},b={class:"box-card-header"},_={style:{position:"relative"}},j={class:"progress-item"},k=y(e({__name:"index",props:{fileType:{default:"*"},dir:{default:null},advanced:{type:Boolean,default:!1}},emits:["saveResource"],setup(e,{emit:y}){const k=e,M=y,R=a(),B=s([{name:"md5",title:"预先处理",failed:"md5计算失败",declared:"通过计算得到文件的 md5 编码",percentage:0,status:""},{name:"upload",title:"上传文件",failed:"文件上传失败",declared:"文件正在发送至服务器",percentage:0,status:""},{name:"save",title:"保存信息",failed:"数据库储存失败",declared:"文件数据存储在数据库中",percentage:0,status:""}]),D=t("选择文件"),E=t("请选择对应格式的文件进行上传操作"),H=t(!1),T=(e,a)=>{(e=>{const a=B[e];D.value=a.title,E.value=a.declared})(a),B[a].status=e>=1?"success":"",B[a].percentage=Math.round(100*Math.min(e,1))},U=async()=>{try{const e=await R.store.fileOpen(k.fileType);H.value=!H.value;const a=await R.store.fileMD5(e,(e=>T(e,0))),s=await R.store.publicHandler();await R.store.fileHas(a,e.extension,s,k.dir)||await R.store.fileUpload(a,e.extension,e,(e=>T(e,1)),s,k.dir),await(async(e,a,s,t)=>{const l={filename:s.name,md5:e,key:e+a,url:R.store.fileUrl(e,a,t,k.dir||"")};T(1,1);try{const e=await w(l);M("saveResource",l.filename,e.data.id,(()=>{T(2,1)}))}catch(i){}})(a,e.extension,e,s)}catch(e){}};return(e,a)=>{const s=g,t=x,y=v,w=o;return l(),i("div",null,[r("div",h,[d(w,{class:"box-card-component",style:{margin:"18px 18px 0"}},{header:n((()=>[r("div",b,[r("h3",null,c(D.value)+":",1),p(" "+c(E.value),1)])])),default:n((()=>[r("div",_,[(l(!0),i(u,null,m(B,(e=>(l(),i("div",{key:e.name},[r("div",j,[r("span",null,c(e.title),1),d(s,{percentage:e.percentage},null,8,["percentage"])])])))),128)),d(t),d(y,{type:"primary",disabled:H.value,onClick:U},{default:n((()=>[f(e.$slots,"default",{},(()=>[p("11")]),!0)])),_:3},8,["disabled"])])])),_:3})])])}}}),[["__scopeId","data-v-671fe0be"]]);export{k as M};
