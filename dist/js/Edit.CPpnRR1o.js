import{d as e,r as l,e as a,h as t,l as u,w as s,a1 as i,B as n,Q as o,R as r,D as d,g as v,f as c,$ as p,p as m,aR as f,Y as y,a0 as b,aw as g,aF as _,aG as k,c as h,o as w,aA as x,aZ as C,b8 as E,b6 as V,b7 as j,aP as I,aQ as z}from"./index.D_6c1BO-.js";/* empty css                        */import{a as R,E as S}from"./el-form.Dzvhq0L7.js";/* empty css               */import"./el-form-item.l0sNRNKZ.js";/* empty css                 */import{E as U}from"./el-image-viewer.DPPB4z2W.js";import{E as D}from"./el-dialog.BAFVqCLi.js";/* empty css                   */import{E as O}from"./el-divider.CDnQysLO.js";import{v as P}from"./v4.aGgpFg1T.js";import{E as q}from"./index.DAlCTFiK.js";import{E as B}from"./index.D3735v7o.js";import{R as F}from"./ResourceDialog.C1-LensV.js";const J={key:0},K={key:1},N={class:"dialog-footer"},G=g(e({__name:"EventDialog",props:{uuid:{},node:{}},emits:["postEvent"],setup(e,{expose:g,emit:_}){const k=l(null),h=l(null),w=e,x=_,C=l(!1),E=l({visible:!1,value:"",list:[]}),V=l({visible:!1,value:"",list:[]}),j=()=>{E.value.value&&E.value.list.push({title:E.value.value,uuid:P()}),E.value.visible=!1,E.value.value=""},I=()=>{V.value.value&&V.value.list.push({title:V.value.value,uuid:P()}),V.value.visible=!1,V.value.value=""},z=async()=>{E.value.visible=!0,y((()=>{var e;null==(e=h.value)||e.focus()}))},R=()=>{V.value.visible=!0,y((()=>{var e;null==(e=k.value)||e.focus()}))},S=()=>{x("postEvent",{node:w.node,inputs:E.value.list,outputs:V.value.list,uuid:w.uuid})},U=e=>{e()};return g({close:()=>{C.value=!1},open:async()=>{await y(),E.value.list=[],w.node&&(w.node.inputs.forEach((e=>{E.value.list.push(e)})),V.value.list=[],w.node.outputs.forEach((e=>{V.value.list.push(e)}))),C.value=!0}}),(e,l)=>{const y=O,g=q,_=B,w=b,x=D;return a(),t("div",null,[u(x,{modelValue:v(C),"onUpdate:modelValue":l[3]||(l[3]=e=>f(C)?C.value=e:null),width:"80%","before-close":U},{header:s((()=>[i(" 事件管理窗口 ")])),footer:s((()=>[n("span",N,[u(w,{onClick:l[2]||(l[2]=e=>C.value=!1)},{default:s((()=>[i("取 消")])),_:1}),u(w,{type:"primary",onClick:S},{default:s((()=>[i("确 定")])),_:1})])])),default:s((()=>[n("div",null,[u(y,{"content-position":"left"},{default:s((()=>[i("输出事件")])),_:1}),(a(!0),t(o,null,r(v(V).list,((e,l)=>(a(),t("span",{key:l},[u(g,{type:"success",closable:"",onClose:l=>(e=>{V.value.list=V.value.list.filter((l=>l.uuid!=e.uuid))})(e)},{default:s((()=>[i(d(e.title),1)])),_:2},1032,["onClose"]),u(y,{direction:"vertical"})])))),128)),v(V).list.length<=5?(a(),t("span",J,[v(V).visible?(a(),c(_,{key:0,class:"input-new-tag",modelValue:v(V).value,"onUpdate:modelValue":l[0]||(l[0]=e=>v(V).value=e),ref_key:"saveTagOutput",ref:k,size:"small",onKeyup:p(I,["enter"]),onBlur:I},null,8,["modelValue"])):(a(),c(w,{key:1,class:"button-new-tag",size:"small",onClick:R},{default:s((()=>[i(" + 输出事件 ")])),_:1}))])):m("",!0),u(y,{"content-position":"left"},{default:s((()=>[i("输入事件")])),_:1}),(a(!0),t(o,null,r(v(E).list,((e,l)=>(a(),t("span",{key:l},[u(g,{type:"success",closable:"",onClose:l=>(e=>{E.value.list=E.value.list.filter((l=>l.uuid!=e.uuid))})(e)},{default:s((()=>[i(d(e.title),1)])),_:2},1032,["onClose"]),u(y,{direction:"vertical"})])))),128)),v(E).list.length<=5?(a(),t("span",K,[v(E).visible?(a(),c(_,{key:0,class:"input-new-tag",modelValue:v(E).value,"onUpdate:modelValue":l[1]||(l[1]=e=>v(E).value=e),ref_key:"saveTagInput",ref:h,size:"small",onKeyup:p(j,["enter"]),onBlur:j},null,8,["modelValue"])):(a(),c(w,{key:1,class:"button-new-tag",size:"small",onClick:z},{default:s((()=>[i(" + 输入事件 ")])),_:1}))])):m("",!0)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-c629b602"]]),Q=e=>(I("data-v-38c074ae"),e=e(),z(),e),T={class:"verse-view"},A=Q((()=>n("b",{id:"title"},"【元数据】名称：",-1))),M=Q((()=>n("br",null,null,-1))),X=Q((()=>n("br",null,null,-1))),Y=Q((()=>n("br",null,null,-1))),Z=Q((()=>n("br",null,null,-1))),$=Q((()=>n("br",null,null,-1))),H=Q((()=>n("div",null,[n("b",null,"【元数据】信息")],-1))),L={class:"box-item"},W=Q((()=>n("br",null,null,-1))),ee=Q((()=>n("br",null,null,-1))),le=Q((()=>n("br",null,null,-1))),ae=g(e({__name:"Edit",emits:["getItem","putItem"],setup(e,{emit:p}){const f=_(),y=k(),g=l(null),I={title:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}]},z=l(null),D=l(null),O=l(),P=h((()=>parseInt(f.query.id,10))),J=p,K=h({get(){var e;return!1!==(null==(e=g.value)?void 0:e.custome)},set(e){g.value&&(g.value.custome=!!e)}}),N=h((()=>g.value?JSON.parse(g.value.events):{inputs:[],outputs:[]})),Q=h((()=>g.value&&g.value.image?g.value.image.url:"")),ae=async()=>{const e=await te(P.value,{expand:"image,author"});g.value=e},te=async(e,l)=>new Promise(((a,t)=>{try{J("getItem",e,l,(e=>{a(e)}))}catch(u){t(u)}})),ue=async(e,l)=>new Promise(((a,t)=>{try{J("putItem",e,l,(e=>{a(e)}))}catch(u){t(u)}})),se=()=>{if(g.value){const e=y.getRoutes().find((e=>"/meta/scene"===e.path));if(e&&e.meta.title){const l=e.meta.title;y.push({path:"/meta/scene",query:{id:P.value,title:l+"【"+g.value.title+"】"}})}}},ie=(e={value:null,callback:null,type:null})=>{},ne=async e=>{g.value&&(g.value.image_id=e.image_id,await ue(P.value,g.value),x.success("保存成功"),await ae())},oe=()=>{O.value&&O.value.openIt({type:"picture"})},re=async({uuid:e,node:l,inputs:a,outputs:t})=>{g.value&&(g.value.events=JSON.stringify({inputs:a,outputs:t})),D.value&&D.value.close()},de=()=>{D.value&&D.value.open()},ve=async()=>{g.value&&(await ue(P.value,g.value),x.success("保存成功"),await ae())};return w(ae),(e,l)=>{const p=U,f=C,y=B,_=R,k=q,h=S,w=b,x=E,P=V,J=j;return a(),t("div",T,[v(g)?(a(),c(G,{key:0,node:JSON.parse(v(g).events),uuid:"uuid",onPostEvent:re,ref_key:"dialog",ref:D},null,8,["node"])):m("",!0),u(F,{onSelected:ne,onCancel:ie,ref_key:"resourceDialog",ref:O},null,512),u(J,{gutter:20,style:{margin:"28px 18px 0"}},{default:s((()=>[u(P,{sm:16},{default:s((()=>[v(g)?(a(),c(f,{key:0,class:"box-card"},{header:s((()=>[n("div",null,[A,n("span",null,d(v(g).title),1)])])),default:s((()=>[n("div",{class:"box-item",onClick:oe},[u(p,{fit:"contain",style:{width:"100%",height:"300px"},src:v(Q)},null,8,["src"])])])),_:1})):m("",!0),M,u(f,{class:"box-card"},{default:s((()=>[v(g)?(a(),c(h,{key:0,ref_key:"itemForm",ref:z,rules:I,model:v(g),"label-width":"80px"},{default:s((()=>[u(_,{label:"名称",prop:"title"},{default:s((()=>[u(y,{modelValue:v(g).title,"onUpdate:modelValue":l[0]||(l[0]=e=>v(g).title=e)},null,8,["modelValue"])])),_:1}),v(N)&&v(N).inputs&&v(N).inputs.length>0?(a(),c(_,{key:0,label:"输入事件"},{default:s((()=>[(a(!0),t(o,null,r(v(N).inputs,((e,l)=>(a(),t("span",{key:l},[u(k,{size:"small"},{default:s((()=>[i(d(e.title),1)])),_:2},1024),i("   ")])))),128))])),_:1})):m("",!0),v(N)&&v(N).outputs&&v(N).outputs.length>0?(a(),c(_,{key:1,label:"输出事件"},{default:s((()=>[(a(!0),t(o,null,r(v(N).outputs,((e,l)=>(a(),t("span",{key:l},[u(k,{size:"small"},{default:s((()=>[i(d(e.title),1)])),_:2},1024),i("   ")])))),128))])),_:1})):m("",!0),v(K)?m("",!0):(a(),c(_,{key:2,label:"数据"},{default:s((()=>[u(y,{type:"textarea",modelValue:v(g).data,"onUpdate:modelValue":l[1]||(l[1]=e=>v(g).data=e)},null,8,["modelValue"])])),_:1})),m("",!0)])),_:1},8,["model"])):m("",!0)])),_:1}),X,null!==v(g)?(a(),c(f,{key:1,class:"box-card"},{default:s((()=>[u(x,{style:{float:"right",padding:"3px 0"}},{default:s((()=>[u(w,{onClick:de,icon:"MagicStick"},{default:s((()=>[i(" 事件编辑 ")])),_:1}),v(g).viewable?(a(),c(w,{key:0,onClick:se,icon:"Edit"},{default:s((()=>[i(" 内容编辑 ")])),_:1})):m("",!0),u(w,{onClick:ve,icon:"CircleCheck",type:"success"},{default:s((()=>[i(" 信息保存 ")])),_:1})])),_:1}),Y,Z])),_:1})):m("",!0),$])),_:1}),u(P,{sm:8},{default:s((()=>[u(f,{class:"box-card"},{header:s((()=>[H])),default:s((()=>[n("div",L,d(v(g)),1),W])),_:1}),ee,le])),_:1})])),_:1})])}}}),[["__scopeId","data-v-38c074ae"]]);export{ae as E};
