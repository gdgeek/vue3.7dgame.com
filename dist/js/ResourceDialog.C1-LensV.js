import{d as e,r as a,c as t,e as l,h as i,l as s,w as n,B as o,g as r,aR as u,f as c,p as d,a1 as m,D as p,aA as g,aZ as f,a0 as v,b8 as y,b6 as _,b7 as w,aP as h,aQ as k,aw as x}from"./index.D_6c1BO-.js";import{E as b}from"./el-dialog.BAFVqCLi.js";/* empty css                   */import{E as C}from"./el-pagination.iB7W_mBW.js";/* empty css               */import"./el-select.txC_RwMJ.js";import"./el-popper.B126Dx6T.js";import{E as z}from"./el-skeleton-item.P-4Smcyt.js";/* empty css                        */import{E as j}from"./el-divider.CDnQysLO.js";import{a as R,E as V}from"./el-tab-pane.UFwFQKRi.js";import{M as B,L as T,W as E}from"./index.CRad9h5U.js";import{C as P}from"./index.Du8HYfpv.js";import{g as S,d as D,p as I}from"./meta-resource.B9bi16Ti.js";/* empty css                       *//* empty css                 */import{E as L}from"./index.sgqfUYPi.js";import{E as M}from"./index.DAlCTFiK.js";const Q=e=>(h("data-v-3e5669b0"),e=e(),k(),e),U={class:"dialog-footer"},A=Q((()=>o("b",null,"选择资源",-1))),K={style:{width:"230px"}},O={class:"mrpp-title"},W={class:"card-title",nowrap:""},X={key:1,style:{width:"100%","text-align":"center"}},Z={key:0,class:"clearfix"},q={key:1,class:"clearfix"},F=Q((()=>o("div",{class:"bottom clearfix"},null,-1))),G={class:"mrpp-title"},H={class:"card-title",nowrap:""},J=["src"],N={style:{width:"100%","text-align":"center"}},Y={class:"clearfix"},$=Q((()=>o("div",{class:"bottom clearfix"},null,-1))),ee=Q((()=>o("br",null,null,-1))),ae={class:"dialog-footer"},te=x(e({__name:"ResourceDialog",emits:["selected","cancel"],setup(e,{expose:h,emit:k}){const x=a(!1),Q=a("binding"),te=a("polygen"),le=a(null),ie=a(null),se=k,ne=a({items:[],sorted:"-created_at",searched:"",pagination:{current:1,count:1,size:20,total:20}}),oe=a({items:[],sorted:"-created_at",searched:"",pagination:{current:1,count:1,size:20,total:20}}),re=t((()=>"binding"===Q.value?ne.value:oe.value)),ue=e=>{for(let a=0;a<e.metaResources.length;++a)if(e.metaResources[a].meta_id===le.value)return!0;return!1},ce=(e,a)=>{be()},de=e=>e.title??e.name??"title",me=async(e,a=null,t=null)=>{ne.value={items:[],sorted:"-created_at",searched:"",pagination:{current:1,count:1,size:20,total:20}},oe.value={items:[],sorted:"-created_at",searched:"",pagination:{current:1,count:1,size:20,total:20}},te.value=t,le.value=a,ie.value=e,await pe(),await ge(),null!==ne.value.items&&0!==ne.value.items.length?Q.value="binding":Q.value="owner",x.value=!0},pe=async()=>{const e=await P(te.value,oe.value.sorted,oe.value.searched,oe.value.pagination.current,"image, metaResources");oe.value.items=e.data},ge=async()=>{const e=await S(le.value,te.value,ne.value.sorted,ne.value.searched,ne.value.pagination.current,"image,author,metaResources");ne.value.items=e.data},fe=e=>{re.value.sorted=e,be()},ve=e=>{re.value.searched=e,be()},ye=()=>{re.value.searched="",be()},_e=e=>{se("selected",e),x.value=!1},we=()=>{ie.value=null,se("selected",null),x.value=!1},he=(e=null)=>{se("selected",e),x.value=!1},ke=()=>{se("cancel")},xe=e=>{re.value.pagination.current=e,be()},be=async()=>{"binding"===Q.value?(await ge(),null!==ne.value.items&&0!==ne.value.items.length||(await pe(),Q.value="owner")):await pe()},Ce=async e=>{try{await L.confirm("是否将资源绑定到场景?","绑定资源",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});await I({meta_id:le.value,resource_id:e.id});await be(),g.success("绑定成功!"),await L.confirm("是否直接确认设置资源?","确认资源",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),he(e),g.success("设置成功!")}catch{g.info("已取消")}};h({openIt:async({selected:e=null,binding:a=null,type:t})=>{await me(e,a,t)},open:me});const ze=t((()=>re.value.items.map((e=>({src:e.file.url,id:e.id?e.id.toString():void 0,name:e.name,info:e.info,uuid:e.uuid,type:e.type,image_id:e.image_id,image:e.image,created_at:e.created_at,file:e.file,metaResources:e.metaResources}))))),je=a({3e3:{rowPerView:8},1800:{rowPerView:6},1200:{rowPerView:4},500:{rowPerView:2}});return(e,a)=>{const t=R,h=V,k=M,P=j,S=f,I=v,te=y,se=z,ne=C,oe=_,me=w,pe=b;return l(),i("div",null,[s(pe,{modelValue:r(x),"onUpdate:modelValue":a[3]||(a[3]=e=>u(x)?x.value=e:null),width:"95%",height:"100px","show-close":!1,onClose:ke},{header:n((()=>[o("div",U,[s(h,{modelValue:r(Q),"onUpdate:modelValue":a[0]||(a[0]=e=>u(Q)?Q.value=e:null),type:"card",class:"demo-tabs",onTabClick:ce},{default:n((()=>[null!=r(le)?(l(),c(t,{key:0,label:"绑定资源",name:"binding"})):d("",!0),s(t,{label:"我的资源",name:"owner"})])),_:1},8,["modelValue"]),s(B,{sorted:r(re).sorted,searched:r(re).searched,onSearch:ve,onSort:fe},{default:n((()=>[s(k,null,{default:n((()=>[A])),_:1})])),_:1},8,["sorted","searched"]),s(P,{"content-position":"left"},{default:n((()=>[""!==r(re).searched?(l(),c(k,{key:0,size:"small",closable:"",onClose:ye},{default:n((()=>[m(p(r(re).searched),1)])),_:1})):d("",!0)])),_:1})])])),footer:n((()=>[o("div",ae,[s(me,{gutter:0},{default:n((()=>[s(oe,{xs:16,sm:16,md:16,lg:16,xl:16},{default:n((()=>[s(ne,{"current-page":r(re).pagination.current,"page-count":r(re).pagination.count,"page-size":r(re).pagination.size,total:r(re).pagination.total,layout:"prev, pager, next, jumper",background:"",onCurrentChange:xe},null,8,["current-page","page-count","page-size","total"])])),_:1}),s(oe,{xs:8,sm:8,md:8,lg:8,xl:8},{default:n((()=>[s(te,null,{default:n((()=>[s(I,{size:"small",onClick:a[1]||(a[1]=e=>he(null))},{default:n((()=>[m("清 空")])),_:1}),s(I,{size:"small",onClick:a[2]||(a[2]=e=>x.value=!1)},{default:n((()=>[m(" 取 消 ")])),_:1})])),_:1})])),_:1})])),_:1})])])),default:n((()=>[null!==r(re)&&null!==r(re).items?(l(),c(r(E),{key:0,lazyload:!1,breakpoints:r(je),gutter:8,list:r(ze),"column-count":3},{item:n((({item:e})=>[o("div",K,["owner"===r(Q)?(l(),c(S,{key:0,style:{width:"220px"},class:"box-card"},{header:n((()=>[s(S,{shadow:"hover","body-style":{padding:"0px"}},{default:n((()=>[o("div",O,[o("b",W,p(e.title),1)]),e.image?(l(),c(r(T),{key:0,style:{width:"100%",height:"180px"},fit:"contain",url:e.image.url},null,8,["url"])):d("",!0),e.created_at?(l(),i("div",X,p(e.created_at),1)):d("",!0)])),_:2},1024)])),default:n((()=>[null!=r(le)?(l(),i("div",Z,[e.id===r(ie)?(l(),c(te,{key:0},{default:n((()=>[s(I,{type:"warning",size:"small",onClick:we},{default:n((()=>[m(" 取消选择 ")])),_:1})])),_:1})):ue(e)?(l(),c(te,{key:1},{default:n((()=>[s(I,{type:"primary",size:"small",onClick:a=>_e(e)},{default:n((()=>[m(" 选择 ")])),_:2},1032,["onClick"]),s(I,{type:"primary",size:"small",onClick:a=>Ce(e)},{default:n((()=>[m(" 取消绑定 ")])),_:2},1032,["onClick"])])),_:2},1024)):(l(),c(I,{key:2,size:"small",onClick:a=>(async e=>{try{await L.confirm("是否解除资源绑定?","解除绑定",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"});for(let a=0;a<e.metaResources.length;++a)if(e.metaResources[a].meta_id==le.value){await D(e.metaResources[a].id);break}await be(),g.success("解绑成功!")}catch{g.info("已取消")}})(e)},{default:n((()=>[m(" 绑定 ")])),_:2},1032,["onClick"]))])):(l(),i("div",q,[s(I,{type:"primary",size:"small",onClick:a=>_e(e)},{default:n((()=>[m(" 选择 ")])),_:2},1032,["onClick"])])),F])),_:2},1024)):(l(),c(S,{key:1,style:{width:"220px"},class:"box-card"},{header:n((()=>[s(S,{shadow:"hover","body-style":{padding:"0px"}},{default:n((()=>[o("div",G,[o("b",H,p(de(e)),1)]),e.image?(l(),i("img",{key:0,style:{width:"100%",height:"180px"},fit:"contain",src:e.image.url,lazy:""},null,8,J)):d("",!0),o("div",N,p(e.created_at),1)])),_:2},1024)])),default:n((()=>[o("div",Y,[null===r(ie)||e.id!==r(ie)?(l(),c(te,{key:0},{default:n((()=>[s(I,{type:"primary",size:"small",onClick:a=>_e(e)},{default:n((()=>[m(" 选择 ")])),_:2},1032,["onClick"]),s(I,{type:"primary",size:"small",onClick:a=>Ce(e)},{default:n((()=>[m(" 取消绑定 ")])),_:2},1032,["onClick"])])),_:2},1024)):(l(),c(te,{key:1},{default:n((()=>[s(I,{type:"warning",size:"small",onClick:we},{default:n((()=>[m(" 取消选择 ")])),_:1})])),_:1}))]),$])),_:2},1024)),ee])])),_:1},8,["breakpoints","list"])):(l(),c(se,{key:1}))])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-3e5669b0"]]);export{te as R};
