import{b5 as e,aX as a,bX as r,d as t,r as s,X as l,o,e as n,f as i,w as u,a1 as d,D as c,l as p,g as m,aR as g,aA as f,a0 as v,c as w,h,B as b,p as y,d7 as _,d8 as x,aZ as j,aP as k,aQ as V,aw as P,ab as E,b8 as C,br as z,b7 as S,bs as U,bt as R,bq as T}from"./index.D_6c1BO-.js";import{E as q}from"./el-pagination.iB7W_mBW.js";/* empty css               */import"./el-select.txC_RwMJ.js";import"./el-popper.B126Dx6T.js";/* empty css                        */import{E as I}from"./el-dialog.BAFVqCLi.js";/* empty css                   */import{a as A,E as B}from"./el-form.Dzvhq0L7.js";import"./el-form-item.l0sNRNKZ.js";/* empty css                 */import{E as L}from"./index.D3735v7o.js";import{L as O,W as M,M as X}from"./index.CRad9h5U.js";/* empty css                       */import{E as D}from"./index.sgqfUYPi.js";import"./isEqual._mAmV373.js";import"./_Uint8Array.DVftYLkF.js";import"./event.CIKxL71l.js";import"./index.DAlCTFiK.js";import"./strings.BAs9FsGt.js";import"./castArray.Dh6ReS0w.js";import"./index.C9igdc6f.js";import"./index.BtcHjPUK.js";import"./use-dialog.BOXoP5e0.js";import"./_initCloneObject.BAbbNCWp.js";import"./aria.D6AGjDMk.js";const F=t({__name:"Creater",props:{dialogTitle:{type:String,default:"选择文件"},dialogSubmit:{type:String,default:"确定"}},emits:["refresh"],setup(a,{expose:r,emit:t}){const w=a,h=t,b=s(!1),y=s(),_=l({username:"",password:"",checkPassword:""}),x={username:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:5,message:"用户名称长度应该大于5",trigger:"blur"},{validator:(e,a,r)=>{_.username=a.replace(/[\u4E00-\u9FA5]/g,""),r()},message:"用户名请避免使用中文",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度应该大于6",trigger:"blur"},{validator:(e,a,r)=>{var t;""===a?r(new Error("请输入密码")):(""!==_.checkPassword&&(null==(t=y.value)||t.validateField("checkPassword")),r())},trigger:"blur"}],checkPassword:[{required:!0,message:"请输入校验密码",trigger:"blur"},{validator:(e,a,r)=>{""===a?r(new Error("请再次输入密码")):a!==_.password?r(new Error("两次输入密码不一致!")):r()},trigger:"blur"}]},j=async()=>{var a,r;try{await(null==(a=y.value)?void 0:a.validate())?(await(r=_,e({url:"v1/people",method:"post",data:r})),h("refresh"),b.value=!1):f.error("表单校验失败")}catch(t){}},k=()=>{b.value=!0};return o((()=>{k()})),r({show:k}),(e,a)=>{const r=L,t=A,s=B,l=v,o=I;return n(),i(o,{modelValue:m(b),"onUpdate:modelValue":a[4]||(a[4]=e=>g(b)?b.value=e:null),"close-on-click-modal":!1,width:"70%"},{header:u((()=>[d(c(w.dialogTitle),1)])),footer:u((()=>[p(l,{onClick:a[3]||(a[3]=e=>b.value=!1)},{default:u((()=>[d("取 消")])),_:1}),p(l,{type:"primary",onClick:j},{default:u((()=>[d("注册账号")])),_:1})])),default:u((()=>[d(" > "),p(s,{ref_key:"formRef",ref:y,rules:x,model:m(_),class:"signup-form","label-width":"80px"},{default:u((()=>[p(t,{label:"用户名",prop:"username",style:{"margin-bottom":"26px"}},{default:u((()=>[p(r,{modelValue:m(_).username,"onUpdate:modelValue":a[0]||(a[0]=e=>m(_).username=e),"suffix-icon":"el-icon-user"},null,8,["modelValue"])])),_:1}),p(t,{label:"密码",prop:"password",style:{"margin-bottom":"26px"}},{default:u((()=>[p(r,{modelValue:m(_).password,"onUpdate:modelValue":a[1]||(a[1]=e=>m(_).password=e),autocomplete:"off","suffix-icon":"el-icon-lock",type:"password"},null,8,["modelValue"])])),_:1}),p(t,{label:"确认密码",prop:"checkPassword",style:{"margin-bottom":"26px"}},{default:u((()=>[p(r,{modelValue:m(_).checkPassword,"onUpdate:modelValue":a[2]||(a[2]=e=>m(_).checkPassword=e),type:"password",autocomplete:"off","suffix-icon":"el-icon-view"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}}),N=e=>(k("data-v-79980fda"),e=e(),V(),e),Q={style:{padding:"14px"}},W={class:"bottom clearfix"},Z=N((()=>b("br",null,null,-1))),J=N((()=>b("br",null,null,-1))),K=P(t({__name:"List",props:{items:{}},emits:["refresh"],setup(a,{emit:r}){const t=a,l=r,o=e=>{var a;return null==(a=null==e?void 0:e.avatar)?void 0:a.url},g=async a=>{try{await D.confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}),await(r=a.id,e({url:"v1/people/"+r,method:"delete"})),f.success("删除成功!"),l("refresh")}catch{f.info("已取消删除")}var r},k=w((()=>{if(!t.items||0===t.items.length)return[];return t.items.map((e=>{var a;return{src:null==(a=e.avatar)?void 0:a.url,id:e.id?e.id.toString():void 0,username:e.username,nickname:e.nickname,roles:e.roles}}))})),V=s({3200:{rowPerView:8},2400:{rowPerView:6},1600:{rowPerView:4},1200:{rowPerView:3},800:{rowPerView:2},600:{rowPerView:1}});return(e,a)=>{const r=_,t=x,s=v,l=j;return n(),h("div",null,[m(k).length>0?(n(),i(m(M),{key:0,lazyload:!0,breakpoints:m(V),gutter:10,list:m(k),"column-count":3},{item:u((({item:e})=>[p(l,{style:{width:"150px"},"body-style":{padding:"0px"}},{default:u((()=>[p(m(O),{url:o(e),class:"image"},null,8,["url"]),b("div",Q,[b("span",null,c(e.username),1),b("div",W,[p(t,{class:"margin-top",title:e.nickname,column:1,size:"small"},{default:u((()=>[p(r,{label:"权限"},{default:u((()=>{return[d(c((a=e.roles,a.includes("root")?"根用户":a.includes("admin")?"超级管理员":a.includes("manager")?"管理员":a.includes("user")?"用户":JSON.stringify(a))),1)];var a})),_:2},1024)])),_:2},1032,["title"]),p(s,{type:"text",class:"button",onClick:a=>g(e)},{default:u((()=>[d(" 删除 ")])),_:2},1032,["onClick"])])])])),_:2},1024),Z,J])),_:1},8,["breakpoints","list"])):y("",!0)])}}}),[["__scopeId","data-v-79980fda"]]),Y={class:"verse-index"},G=b("br",null,null,-1),H=b("span",{class:"hidden-sm-and-down"},"添加用户",-1),$=b("br",null,null,-1),ee=t({__name:"Page",props:{created:{type:Boolean}},emits:["loaded"],setup(e,{emit:a}){const r=e,t=a,l=s([]),c=s("-created_at"),g=s(""),f=s({current:1,count:1,size:20,total:20}),w=s(),b=()=>{w.value&&w.value.show()},_=async e=>{f.value.current=e,await V()},x=async e=>{c.value=e,await V()},k=async e=>{g.value=e,await V()},V=()=>{t("loaded",{sorted:c.value,searched:g.value,current:f.value.current},(e=>{e&&e.data?(l.value=e.data,f.value=e.pagination,setTimeout((()=>window.dispatchEvent(new Event("resize"))),100)):l.value=[]}))};return o(V),(e,a)=>{const t=E("font-awesome-icon"),s=v,o=C,P=z,I=S,A=U,B=q,L=j,O=R,M=T;return n(),h("div",Y,[r.created?(n(),i(F,{key:0,ref_key:"createdDialogRef",ref:w,"close-on-click-modal":!1,"dialog-title":"添加用户",onRefresh:V,"dialog-submit":"添加用户"},null,512)):y("",!0),G,p(M,null,{default:u((()=>[p(P,null,{default:u((()=>[p(X,{sorted:m(c),searched:m(g),onSearch:k,onSort:x},{default:u((()=>[p(o,{inline:!0},{default:u((()=>[e.created?(n(),i(s,{key:0,size:"small",type:"primary",onClick:b},{default:u((()=>[p(t,{icon:"plus"}),d("   "),H])),_:1})):y("",!0)])),_:1})])),_:1},8,["sorted","searched"])])),_:1}),p(A,null,{default:u((()=>[p(I,null,{default:u((()=>[m(l)&&m(l).length>0?(n(),i(K,{key:0,items:m(l),onRefresh:V},null,8,["items"])):y("",!0)])),_:1})])),_:1}),p(O,null,{default:u((()=>[p(L,{class:"box-card"},{default:u((()=>[p(B,{"current-page":m(f).current,"page-count":m(f).count,"page-size":m(f).size,total:m(f).total,layout:"prev, pager, next, jumper",background:"",onCurrentChange:_},null,8,["current-page","page-count","page-size","total"])])),_:1})])),_:1})])),_:1}),$])}}}),ae={class:"verse-index"},re=t({__name:"user",setup(t){const s=async(t,s)=>{try{const l=await((t="-created_at",s="",l=1,o="")=>{const n=[];return n.expand=o,n.sort=t,""!==s&&(n["UserSearch[username]"]=s),l>1&&(n.page=l),e({url:a.join("v1","people"+r.stringify(n,!0)),method:"get"})})(t.sorted,t.searched,t.current,"roles, avatar"),o={current:parseInt(l.headers["x-pagination-current-page"]),count:parseInt(l.headers["x-pagination-page-count"]),size:parseInt(l.headers["x-pagination-per-page"]),total:parseInt(l.headers["x-pagination-total-count"])};s({data:l.data,pagination:o})}catch(l){}};return(e,a)=>(n(),h("div",ae,[p(ee,{onLoaded:s,created:!0})]))}});export{re as default};
