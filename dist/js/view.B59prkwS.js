import{d as e,aF as t,aG as a,bo as i,r as s,c as l,o,e as n,h as r,l as d,w as c,b7 as u,g as m,D as p,p as v,B as f,a1 as y,aA as x,aZ as g,b6 as h,a0 as w,b8 as j,aP as b,aQ as _,aw as B}from"./index.D_6c1BO-.js";/* empty css                        */import{E,a as T}from"./el-table-column.CynXfIkF.js";import"./el-checkbox.DLYn-MOp.js";import"./el-tooltip.l0sNRNKZ.js";import"./el-popper.B126Dx6T.js";/* empty css               */import{w as k,q as I,u as C,t as O}from"./index.Du8HYfpv.js";import{p as z}from"./files.D66WF0_8.js";/* empty css                       *//* empty css                 *//* empty css                   */import{E as D}from"./index.sgqfUYPi.js";import"./event.CIKxL71l.js";import"./index.D3735v7o.js";import"./isEqual._mAmV373.js";import"./_Uint8Array.DVftYLkF.js";import"./_initCloneObject.BAbbNCWp.js";import"./index.C9igdc6f.js";import"./v4.aGgpFg1T.js";import"./index.BtcHjPUK.js";import"./aria.D6AGjDMk.js";const U=e=>(b("data-v-2f0d996f"),e=e(),_(),e),q={class:"document-index"},F=U((()=>f("b",{id:"title"},"图片名称：",-1))),H={key:0},M={class:"box-item",style:{"text-align":"center"}},P={id:"video",controls:"true",style:{height:"300px",width:"100%"}},S=["src"],A=U((()=>f("br",null,null,-1))),J=U((()=>f("b",null,"视频信息",-1))),L={class:"box-item"},N={style:{"margin-top":"10px","margin-bottom":"30px"}},Q=U((()=>f("i",{class:"el-icon-edit"},null,-1))),W=U((()=>f("i",{class:"el-icon-delete"},null,-1))),Z=U((()=>f("br",null,null,-1))),G=B(e({__name:"view",setup(e){const b=t(),_=a(),B=i().store,U=s(null),G=s(null),K=s(!0),R=l((()=>b.query.id)),V=l((()=>null!==U.value&&null!==U.value.info));o((async()=>{K.value=!0;const e=await k(R.value);U.value=e.data,G.value=e.data.file.url,setTimeout((()=>{X()}),0)}));const Y=l((()=>U.value&&V.value?[{item:"视频名称",text:U.value.name},{item:"创建者",text:U.value.author.nickname},{item:"创建时间",text:U.value.created_at},{item:"文件大小",text:U.value.file.size+"字节"},{item:"视频尺寸",text:I(JSON.parse(U.value.info).size)}]:[])),X=()=>{const e=document.getElementById("video"),t=document.getElementById("src"),a=document.getElementById("new_video");a.src=t.src+"?t="+new Date,a.crossOrigin="anonymous",a.currentTime=1e-6,e.addEventListener("timeupdate",(()=>{a.currentTime=e.currentTime}),!1)},$=()=>{if(V.value)K.value=!1;else{const e=document.getElementById("video"),t=document.getElementById("new_video"),a={x:e.videoWidth,y:e.videoHeight};ee(t,a)}},ee=async(e,t)=>{if(0!==t.x){const a=JSON.stringify({size:t}),i=await((e,t,a)=>new Promise(((i,s)=>{const l="image/jpeg",o=document.createElement("canvas");o.width=t,o.height=a;const n=o.getContext("2d");n&&(n.drawImage(e,0,0,t,a),o.toBlob((e=>{if(e){const t=new File([e],"thumbnail.jpg",{type:l,lastModified:(new Date).getTime()});i(t)}else s("Failed to create blob")}),l))})))(e,.5*t.x,.5*t.y),s=await B.fileMD5(i),l=await B.publicHandler();await B.fileHas(s,i.type.split("/").pop(),l,"screenshot/video")||await B.fileUpload(s,i.type.split("/").pop(),i,(e=>{}),l,"screenshot/video"),await(async(e,t,a,i,s)=>{const l={md5:e,key:e+t,filename:i.name,url:B.fileUrl(e,t,s,"screenshot/video")};try{const e={image_id:(await z(l)).data.id,info:a},t=await O(U.value.id,e);U.value.image_id=t.data.image_id,U.value.info=t.data.info,K.value=!1}catch(o){}})(s,i.type.split("/").pop(),a,i,l)}},te=async()=>{try{await D.confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C(U.value.id),x.success("删除成功!"),_.push({path:"/resource/video/index"})}catch{x.info("已取消删除")}},ae=async()=>{try{const{value:e}=await D.prompt("请输入新名称","修改图片名称",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputValue:U.value.name});e?(await ie(U.value.id,e),x.success("新的视频名称: "+e)):x.info("取消输入")}catch{x.info("取消输入")}},ie=async(e,t)=>{try{const a=await O(e,{name:t});U.value.name=a.data.name}catch(a){}};return(e,t)=>{const a=g,i=h,s=E,l=T,o=w,x=j,b=u;return n(),r("div",q,[d(b,{gutter:20,style:{margin:"28px 18px 0"}},{default:c((()=>[d(i,{sm:16},{default:c((()=>[d(a,{class:"box-card"},{header:c((()=>[F,m(U)?(n(),r("span",H,p(m(U).name),1)):v("",!0)])),default:c((()=>[f("div",M,[f("video",P,[null!==m(G)?(n(),r("source",{key:0,id:"src",src:m(G)},null,8,S)):v("",!0)]),f("video",{id:"new_video",style:{height:"100%",width:"100%"},hidden:"",onCanplaythrough:$},null,32)])])),_:1}),A])),_:1}),d(i,{sm:8},{default:c((()=>[d(a,{class:"box-card"},{header:c((()=>[J,y(": ")])),default:c((()=>[f("div",L,[d(l,{data:m(Y),stripe:""},{default:c((()=>[d(s,{prop:"item",label:"条目"}),d(s,{prop:"text",label:"内容"})])),_:1},8,["data"]),f("aside",N,[d(x,{style:{float:"right"}},{default:c((()=>[d(o,{type:"primary",size:"small",onClick:ae},{default:c((()=>[Q,y(" 改名 ")])),_:1}),d(o,{type:"primary",size:"small",onClick:te},{default:c((()=>[W,y(" 删除 ")])),_:1})])),_:1})])])])),_:1}),Z])),_:1})])),_:1})])}}}),[["__scopeId","data-v-2f0d996f"]]);export{G as default};
