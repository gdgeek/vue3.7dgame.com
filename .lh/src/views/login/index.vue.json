{
    "sourceFile": "src/views/login/index.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 22,
            "patches": [
                {
                    "date": 1721119974502,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1721120017332,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,9 @@\n           target=\"_blank\"\n           :underline=\"false\"\n         >\n           <el-icon><HomeFilled /></el-icon>\n-          上海不加班网络有限公司(Apple Reality Spirit)\n+          上海不加班网络有限公司(bujiaban.com)\n         </RouterLink>\n         <!-- <br> -->\n         <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n           <el-icon><Document /></el-icon>\n"
                },
                {
                    "date": 1721120023107,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,9 @@\n           target=\"_blank\"\n           :underline=\"false\"\n         >\n           <el-icon><HomeFilled /></el-icon>\n-          上海不加班网络有限公司(bujiaban.com)\n+          上海不加班网络有限公司(http://bujiaban.com)\n         </RouterLink>\n         <!-- <br> -->\n         <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n           <el-icon><Document /></el-icon>\n"
                },
                {
                    "date": 1721120031468,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,9 +152,9 @@\n           target=\"_blank\"\n           :underline=\"false\"\n         >\n           <el-icon><HomeFilled /></el-icon>\n-          上海不加班网络有限公司(http://bujiaban.com)\n+          上海不加班网络有限公司（https://bujiaban.com）\n         </RouterLink>\n         <!-- <br> -->\n         <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n           <el-icon><Document /></el-icon>\n"
                },
                {
                    "date": 1721120041171,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -151,9 +151,9 @@\n           to=\"https://bujiaban.com\"\n           target=\"_blank\"\n           :underline=\"false\"\n         >\n-          <el-icon><HomeFilled /></el-icon>\n+          <el-icon><HomeFilled /> </el-icon>\n           上海不加班网络有限公司（https://bujiaban.com）\n         </RouterLink>\n         <!-- <br> -->\n         <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n"
                },
                {
                    "date": 1721120094129,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,9 +147,9 @@\n     </div>\n     <div class=\"footer\">\n       <div class=\"copyright\">\n         <RouterLink\n-          to=\"https://bujiaban.com\"\n+          to=\"https://bujiaban.com/\"\n           target=\"_blank\"\n           :underline=\"false\"\n         >\n           <el-icon><HomeFilled /> </el-icon>\n"
                },
                {
                    "date": 1721120173351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,301 @@\n+<script setup lang=\"ts\">\n+import { ref, computed } from \"vue\";\n+import { RouterLink, useRouter } from \"vue-router\";\n+import { FormInstance } from \"element-plus\";\n+import { useUserStore } from \"@/store/modules/user\";\n+import { LoginData } from \"@/api/auth/model\";\n+import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n+\n+const userStore = useUserStore();\n+\n+const form = ref<LoginData>({\n+  username: \"huyuelong\",\n+  password: \"123456hu\",\n+});\n+\n+const rules = computed(() => {\n+  return {\n+    username: [\n+      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n+      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n+    ],\n+    password: [\n+      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n+      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n+    ],\n+  };\n+});\n+\n+const router = useRouter();\n+const formRef = ref<FormInstance>();\n+const isShow = ref(false);\n+const title = ref<string | Record<string, string>>(\"\");\n+\n+// 登录成功\n+const succeed = (data: any) => {\n+  ElMessage.success(\"登录成功\");\n+  console.log(data);\n+  const token = data.access_token;\n+  console.log(token);\n+  if (token) {\n+    setToken(token);\n+    router.push(\"/\"); // 登录成功后重定向到首页\n+  } else {\n+    failed(\"登录响应中缺少 access_token\");\n+  }\n+};\n+\n+// 设置token\n+const setToken = (token: string) => {\n+  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n+};\n+\n+// 登录失败\n+const failed = (message: any) => {\n+  error(message);\n+};\n+\n+// 提交登录表单\n+function submit() {\n+  formRef.value?.validate((valid: boolean) => {\n+    if (valid) {\n+      userStore\n+        .login(form.value)\n+        .then((data) => {\n+          succeed(data);\n+        })\n+        .catch((error) => {\n+          failed(error);\n+        });\n+    }\n+  });\n+}\n+// const submit = () => {\n+//   formRef.value?.validate(async (valid: boolean) => {\n+//     if (valid) {\n+//       const res = await AuthAPI.login(form.value);\n+//       console.log(\"res:\", res.data.access_token);\n+//     }\n+//   });\n+// };\n+\n+// 显示错误信息\n+const error = (msg: string | Record<string, string>) => {\n+  title.value =\n+    typeof msg === \"string\"\n+      ? msg\n+      : Object.keys(msg)\n+          .map((key) => `${key} : ${msg[key]}`)\n+          .join(\"\\n\");\n+  isShow.value = true;\n+};\n+</script>\n+\n+<template>\n+  <body>\n+    <div class=\"header\">\n+      <RouterLink to=\"/\" class=\"logo\">\n+        <img src=\"/public/favicon.ico\" alt=\"\" />\n+        <span class=\"project_title\">苹果AR元气项目</span>\n+      </RouterLink>\n+      <div class=\"header-right\">\n+        <el-button>平台注册/登录</el-button>\n+      </div>\n+      <div class=\"blog\">\n+        <a>开发博客</a>\n+      </div>\n+    </div>\n+    <div class=\"content\">\n+      <div>\n+        <h2 class=\"login-title\">登录账号</h2>\n+        <el-form\n+          ref=\"formRef\"\n+          class=\"login-body\"\n+          :rules=\"rules\"\n+          :model=\"form\"\n+          label-width=\"75px\"\n+        >\n+          <el-form-item label=\"用户名\" prop=\"username\">\n+            <el-input v-model=\"form.username\" suffix-icon=\"User\" />\n+          </el-form-item>\n+          <el-form-item label=\"密码\" prop=\"password\">\n+            <el-input\n+              v-model=\"form.password\"\n+              type=\"password\"\n+              suffix-icon=\"Lock\"\n+            />\n+          </el-form-item>\n+\n+          <el-form-item class=\"login-button\">\n+            <el-button style=\"width: 120px\" type=\"primary\" @click=\"submit\">\n+              进入\n+            </el-button>\n+          </el-form-item>\n+        </el-form>\n+        <div class=\"login-link\">\n+          <router-link to=\"/site/signup\">\n+            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n+          </router-link>\n+          <br />\n+          <router-link to=\"/site/request-password-reset\">\n+            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n+          </router-link>\n+          <br />\n+        </div>\n+        <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n+      </div>\n+    </div>\n+    <div class=\"footer\">\n+      <div class=\"copyright\">\n+        <RouterLink\n+          to=\"https://bujiaban.com/\"\n+          target=\"_blank\"\n+          :underline=\"false\"\n+        >\n+        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+          <el-icon><HomeFilled /> </el-icon>\n+          上海不加班网络有限公司（https://bujiaban.com）\n+        </a>\n+        <!-- <br> -->\n+        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+          <el-icon><Document /></el-icon>\n+          沪ICP备15039333号\n+        </a>\n+        <a href=\"#\">\n+          <el-icon><InfoFilled /></el-icon>\n+          2024\n+        </a>\n+      </div>\n+    </div>\n+  </body>\n+</template>\n+\n+<style scoped lang=\"scss\">\n+body {\n+  height: 100%;\n+  margin: 0;\n+  position: fixedg;\n+}\n+\n+body {\n+  display: flex;\n+  flex-direction: column;\n+}\n+\n+.header,\n+.footer {\n+  height: 7%;\n+  width: 100%;\n+  background-color: #f1f1f1;\n+  position: relative;\n+  display: flex;\n+  align-items: center;\n+  margin-right: 10px;\n+}\n+\n+.logo {\n+  position: absolute;\n+  left: 10px;\n+  img {\n+    width: 32px;\n+    height: 32px;\n+    vertical-align: middle;\n+    margin-left: 12px;\n+  }\n+  .project_title {\n+    margin-left: 10px;\n+    color: #909399;\n+    font-size: 14px;\n+    font-family: \"SourceHanSansSC-VF\";\n+    font-weight: 400;\n+  }\n+}\n+\n+.blog {\n+  position: absolute;\n+  margin-left: 300px;\n+  height: 60px;\n+  line-height: 60px;\n+  color: #909399;\n+  font-size: 14px;\n+  font-family: \"SourceHanSansSC-VF\";\n+  font-weight: 400;\n+  &:hover {\n+    color: #000000;\n+  }\n+}\n+\n+.header-right {\n+  position: absolute;\n+  right: 10px;\n+}\n+\n+.content {\n+  flex: 1;\n+  width: 100%;\n+  background-image: url(\"/public/media/bg/02.jpg\");\n+  background-size: 100% auto;\n+  display: flex;\n+  align-items: center;\n+  justify-content: center;\n+\n+  .login-title {\n+    margin: 20px 0;\n+    font-weight: bold;\n+    color: #444;\n+    text-align: center;\n+  }\n+\n+  .login-body {\n+    max-width: 100%;\n+    height: 100%;\n+    padding: 10px 40px 0 10px;\n+    margin-top: 36px;\n+  }\n+\n+  .login-button {\n+    text-align: right;\n+  }\n+\n+  .login-link {\n+    padding: 0 10px;\n+    margin-bottom: 20px;\n+  }\n+\n+  .login-link a {\n+    font-size: 16px;\n+    color: rgb(28 160 212);\n+  }\n+\n+  .error-message {\n+    margin-top: 10px;\n+    color: red;\n+    text-align: center;\n+  }\n+}\n+\n+.footer {\n+  text-align: center;\n+  font-size: 12px;\n+  margin: 0 30px;\n+  line-height: 80px;\n+  .copyright {\n+    position: absolute;\n+    right: 10px;\n+  }\n+  .copyright a {\n+    color: rgb(3, 3, 3);\n+    padding: 0 20px;\n+    font-size: 14px;\n+  }\n+  .copyright a:hover {\n+    color: rgb(11, 175, 240);\n+  }\n+}\n+.fixed-footer {\n+  position: fixed;\n+  bottom: 0;\n+  width: 100%;\n+  z-index: 1;\n+}\n+</style>\n"
                },
                {
                    "date": 1721120179469,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,14 +146,9 @@\n       </div>\n     </div>\n     <div class=\"footer\">\n       <div class=\"copyright\">\n-        <RouterLink\n-          to=\"https://bujiaban.com/\"\n-          target=\"_blank\"\n-          :underline=\"false\"\n-        >\n-        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+        <a href=\"https://bujiaban.com/\" target=\"_blank\" :underline=\"false\">\n           <el-icon><HomeFilled /> </el-icon>\n           上海不加班网络有限公司（https://bujiaban.com）\n         </a>\n         <!-- <br> -->\n@@ -298,304 +293,4 @@\n   width: 100%;\n   z-index: 1;\n }\n </style>\n-<script setup lang=\"ts\">\n-import { ref, computed } from \"vue\";\n-import { RouterLink, useRouter } from \"vue-router\";\n-import { FormInstance } from \"element-plus\";\n-import { useUserStore } from \"@/store/modules/user\";\n-import { LoginData } from \"@/api/auth/model\";\n-import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n-\n-const userStore = useUserStore();\n-\n-const form = ref<LoginData>({\n-  username: \"huyuelong\",\n-  password: \"123456hu\",\n-});\n-\n-const rules = computed(() => {\n-  return {\n-    username: [\n-      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n-      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n-    ],\n-    password: [\n-      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n-      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n-    ],\n-  };\n-});\n-\n-const router = useRouter();\n-const formRef = ref<FormInstance>();\n-const isShow = ref(false);\n-const title = ref<string | Record<string, string>>(\"\");\n-\n-// 登录成功\n-const succeed = (data: any) => {\n-  ElMessage.success(\"登录成功\");\n-  console.log(data);\n-  const token = data.access_token;\n-  console.log(token);\n-  if (token) {\n-    setToken(token);\n-    router.push(\"/\"); // 登录成功后重定向到首页\n-  } else {\n-    failed(\"登录响应中缺少 access_token\");\n-  }\n-};\n-\n-// 设置token\n-const setToken = (token: string) => {\n-  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n-};\n-\n-// 登录失败\n-const failed = (message: any) => {\n-  error(message);\n-};\n-\n-// 提交登录表单\n-function submit() {\n-  formRef.value?.validate((valid: boolean) => {\n-    if (valid) {\n-      userStore\n-        .login(form.value)\n-        .then((data) => {\n-          succeed(data);\n-        })\n-        .catch((error) => {\n-          failed(error);\n-        });\n-    }\n-  });\n-}\n-// const submit = () => {\n-//   formRef.value?.validate(async (valid: boolean) => {\n-//     if (valid) {\n-//       const res = await AuthAPI.login(form.value);\n-//       console.log(\"res:\", res.data.access_token);\n-//     }\n-//   });\n-// };\n-\n-// 显示错误信息\n-const error = (msg: string | Record<string, string>) => {\n-  title.value =\n-    typeof msg === \"string\"\n-      ? msg\n-      : Object.keys(msg)\n-          .map((key) => `${key} : ${msg[key]}`)\n-          .join(\"\\n\");\n-  isShow.value = true;\n-};\n-</script>\n-\n-<template>\n-  <body>\n-    <div class=\"header\">\n-      <RouterLink to=\"/\" class=\"logo\">\n-        <img src=\"/public/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">苹果AR元气项目</span>\n-      </RouterLink>\n-      <div class=\"header-right\">\n-        <el-button>平台注册/登录</el-button>\n-      </div>\n-      <div class=\"blog\">\n-        <a>开发博客</a>\n-      </div>\n-    </div>\n-    <div class=\"content\">\n-      <div>\n-        <h2 class=\"login-title\">登录账号</h2>\n-        <el-form\n-          ref=\"formRef\"\n-          class=\"login-body\"\n-          :rules=\"rules\"\n-          :model=\"form\"\n-          label-width=\"75px\"\n-        >\n-          <el-form-item label=\"用户名\" prop=\"username\">\n-            <el-input v-model=\"form.username\" suffix-icon=\"User\" />\n-          </el-form-item>\n-          <el-form-item label=\"密码\" prop=\"password\">\n-            <el-input\n-              v-model=\"form.password\"\n-              type=\"password\"\n-              suffix-icon=\"Lock\"\n-            />\n-          </el-form-item>\n-\n-          <el-form-item class=\"login-button\">\n-            <el-button style=\"width: 120px\" type=\"primary\" @click=\"submit\">\n-              进入\n-            </el-button>\n-          </el-form-item>\n-        </el-form>\n-        <div class=\"login-link\">\n-          <router-link to=\"/site/signup\">\n-            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n-          </router-link>\n-          <br />\n-          <router-link to=\"/site/request-password-reset\">\n-            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n-          </router-link>\n-          <br />\n-        </div>\n-        <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n-      </div>\n-    </div>\n-    <div class=\"footer\">\n-      <div class=\"copyright\">\n-        <RouterLink\n-          to=\"https://bujiaban.com/\"\n-          target=\"_blank\"\n-          :underline=\"false\"\n-        >\n-          <el-icon><HomeFilled /> </el-icon>\n-          上海不加班网络有限公司（https://bujiaban.com）\n-        </RouterLink>\n-        <!-- <br> -->\n-        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon><Document /></el-icon>\n-          沪ICP备15039333号\n-        </a>\n-        <a href=\"#\">\n-          <el-icon><InfoFilled /></el-icon>\n-          2024\n-        </a>\n-      </div>\n-    </div>\n-  </body>\n-</template>\n-\n-<style scoped lang=\"scss\">\n-body {\n-  height: 100%;\n-  margin: 0;\n-  position: fixedg;\n-}\n-\n-body {\n-  display: flex;\n-  flex-direction: column;\n-}\n-\n-.header,\n-.footer {\n-  height: 7%;\n-  width: 100%;\n-  background-color: #f1f1f1;\n-  position: relative;\n-  display: flex;\n-  align-items: center;\n-  margin-right: 10px;\n-}\n-\n-.logo {\n-  position: absolute;\n-  left: 10px;\n-  img {\n-    width: 32px;\n-    height: 32px;\n-    vertical-align: middle;\n-    margin-left: 12px;\n-  }\n-  .project_title {\n-    margin-left: 10px;\n-    color: #909399;\n-    font-size: 14px;\n-    font-family: \"SourceHanSansSC-VF\";\n-    font-weight: 400;\n-  }\n-}\n-\n-.blog {\n-  position: absolute;\n-  margin-left: 300px;\n-  height: 60px;\n-  line-height: 60px;\n-  color: #909399;\n-  font-size: 14px;\n-  font-family: \"SourceHanSansSC-VF\";\n-  font-weight: 400;\n-  &:hover {\n-    color: #000000;\n-  }\n-}\n-\n-.header-right {\n-  position: absolute;\n-  right: 10px;\n-}\n-\n-.content {\n-  flex: 1;\n-  width: 100%;\n-  background-image: url(\"/public/media/bg/02.jpg\");\n-  background-size: 100% auto;\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n-\n-  .login-title {\n-    margin: 20px 0;\n-    font-weight: bold;\n-    color: #444;\n-    text-align: center;\n-  }\n-\n-  .login-body {\n-    max-width: 100%;\n-    height: 100%;\n-    padding: 10px 40px 0 10px;\n-    margin-top: 36px;\n-  }\n-\n-  .login-button {\n-    text-align: right;\n-  }\n-\n-  .login-link {\n-    padding: 0 10px;\n-    margin-bottom: 20px;\n-  }\n-\n-  .login-link a {\n-    font-size: 16px;\n-    color: rgb(28 160 212);\n-  }\n-\n-  .error-message {\n-    margin-top: 10px;\n-    color: red;\n-    text-align: center;\n-  }\n-}\n-\n-.footer {\n-  text-align: center;\n-  font-size: 12px;\n-  margin: 0 30px;\n-  line-height: 80px;\n-  .copyright {\n-    position: absolute;\n-    right: 10px;\n-  }\n-  .copyright a {\n-    color: rgb(3, 3, 3);\n-    padding: 0 20px;\n-    font-size: 14px;\n-  }\n-  .copyright a:hover {\n-    color: rgb(11, 175, 240);\n-  }\n-}\n-.fixed-footer {\n-  position: fixed;\n-  bottom: 0;\n-  width: 100%;\n-  z-index: 1;\n-}\n-</style>\n"
                },
                {
                    "date": 1721121463533,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,9 +95,9 @@\n   <body>\n     <div class=\"header\">\n       <RouterLink to=\"/\" class=\"logo\">\n         <img src=\"/public/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">苹果AR元气项目</span>\n+        <span class=\"project_title\">Voxel Party</span>\n       </RouterLink>\n       <div class=\"header-right\">\n         <el-button>平台注册/登录</el-button>\n       </div>\n"
                },
                {
                    "date": 1724836268154,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,16 @@\n <script setup lang=\"ts\">\n+import \"@/assets/font/font.css\";\n import { ref, computed } from \"vue\";\n-import { RouterLink, useRouter } from \"vue-router\";\n+import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n import { FormInstance } from \"element-plus\";\n import { useUserStore } from \"@/store/modules/user\";\n import { LoginData } from \"@/api/auth/model\";\n import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n+import AuthAPI from \"@/api/auth/index\";\n \n const userStore = useUserStore();\n+const route = useRoute();\n \n const form = ref<LoginData>({\n   username: \"huyuelong\",\n   password: \"123456hu\",\n@@ -33,14 +36,21 @@\n \n // 登录成功\n const succeed = (data: any) => {\n   ElMessage.success(\"登录成功\");\n-  console.log(data);\n   const token = data.access_token;\n-  console.log(token);\n+  console.log(\"token:\", token);\n   if (token) {\n     setToken(token);\n-    router.push(\"/\"); // 登录成功后重定向到首页\n+    const res = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", res);\n+    nextTick(() => {\n+      router.push(\"/\");\n+      console.log(\"Routing to home\"); // 确认路由跳转\n+    });\n+    // const { path, queryParams } = parseRedirect();\n+    // console.log(\"路由：\", path, queryParams);\n+    // router.push({ path: path, query: queryParams });\n   } else {\n     failed(\"登录响应中缺少 access_token\");\n   }\n };\n@@ -49,36 +59,51 @@\n const setToken = (token: string) => {\n   localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n };\n \n+// 解析 redirect 字符串 为 path 和  queryParams\n+function parseRedirect(): {\n+  path: string;\n+  queryParams: Record<string, string>;\n+} {\n+  const query: LocationQuery = route.query;\n+  const redirect = (query.redirect as string) ?? \"/\";\n+\n+  const url = new URL(redirect, window.location.origin);\n+  const path = url.pathname;\n+  const queryParams: Record<string, string> = {};\n+\n+  url.searchParams.forEach((value, key) => {\n+    queryParams[key] = value;\n+  });\n+\n+  return { path, queryParams };\n+}\n+\n // 登录失败\n const failed = (message: any) => {\n   error(message);\n };\n \n-// 提交登录表单\n-function submit() {\n-  formRef.value?.validate((valid: boolean) => {\n+const submit = () => {\n+  formRef.value?.validate(async (valid: boolean) => {\n     if (valid) {\n-      userStore\n-        .login(form.value)\n-        .then((data) => {\n-          succeed(data);\n-        })\n-        .catch((error) => {\n-          failed(error);\n-        });\n+      try {\n+        const res = await AuthAPI.login(form.value);\n+        await succeed(res.data);\n+        const userin = await userStore.getUserInfo();\n+        console.log(\"userin:\", userin);\n+        const { path, queryParams } = await parseRedirect();\n+        console.log(\"path:\", path, \"queryParams:\", queryParams);\n+        await router.push({ path: path, query: queryParams });\n+      } catch (error) {\n+        failed(error);\n+      }\n+    } else {\n+      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n     }\n   });\n-}\n-// const submit = () => {\n-//   formRef.value?.validate(async (valid: boolean) => {\n-//     if (valid) {\n-//       const res = await AuthAPI.login(form.value);\n-//       console.log(\"res:\", res.data.access_token);\n-//     }\n-//   });\n-// };\n+};\n \n // 显示错误信息\n const error = (msg: string | Record<string, string>) => {\n   title.value =\n@@ -94,10 +119,10 @@\n <template>\n   <body>\n     <div class=\"header\">\n       <RouterLink to=\"/\" class=\"logo\">\n-        <img src=\"/public/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">Voxel Party</span>\n+        <img src=\"/favicon.ico\" alt=\"\" />\n+        <span class=\"project_title\">苹果AR元气项目</span>\n       </RouterLink>\n       <div class=\"header-right\">\n         <el-button>平台注册/登录</el-button>\n       </div>\n@@ -105,119 +130,135 @@\n         <a>开发博客</a>\n       </div>\n     </div>\n     <div class=\"content\">\n-      <div>\n-        <h2 class=\"login-title\">登录账号</h2>\n-        <el-form\n-          ref=\"formRef\"\n-          class=\"login-body\"\n-          :rules=\"rules\"\n-          :model=\"form\"\n-          label-width=\"75px\"\n-        >\n-          <el-form-item label=\"用户名\" prop=\"username\">\n-            <el-input v-model=\"form.username\" suffix-icon=\"User\" />\n-          </el-form-item>\n-          <el-form-item label=\"密码\" prop=\"password\">\n-            <el-input\n-              v-model=\"form.password\"\n-              type=\"password\"\n-              suffix-icon=\"Lock\"\n-            />\n-          </el-form-item>\n+      <div class=\"box1\">\n+        <div class=\"box2\">\n+          <h1>欢迎!</h1>\n+          <h4>准备好出发了么？</h4>\n+          <div class=\"box3\">\n+            <h2 class=\"login-title\">登录账号</h2>\n+            <el-form\n+              ref=\"formRef\"\n+              class=\"login-form\"\n+              :rules=\"rules\"\n+              :model=\"form\"\n+              label-width=\"75px\"\n+            >\n+              <el-form-item label=\"用户名\" prop=\"username\">\n+                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n+              </el-form-item>\n+              <el-form-item label=\"密码\" prop=\"password\">\n+                <el-input\n+                  v-model=\"form.password\"\n+                  type=\"password\"\n+                  suffix-icon=\"Lock\"\n+                ></el-input>\n+              </el-form-item>\n \n-          <el-form-item class=\"login-button\">\n-            <el-button style=\"width: 120px\" type=\"primary\" @click=\"submit\">\n-              进入\n-            </el-button>\n-          </el-form-item>\n-        </el-form>\n-        <div class=\"login-link\">\n+              <el-form-item class=\"login-button\">\n+                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n+                  登录平台\n+                </el-button>\n+              </el-form-item>\n+            </el-form>\n+            <!-- <div class=\"login-link\">\n           <router-link to=\"/site/signup\">\n             <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n           </router-link>\n           <br />\n           <router-link to=\"/site/request-password-reset\">\n             <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n           </router-link>\n           <br />\n+        </div> -->\n+            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n+          </div>\n+          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n         </div>\n-        <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n       </div>\n     </div>\n     <div class=\"footer\">\n       <div class=\"copyright\">\n-        <a href=\"https://bujiaban.com/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon><HomeFilled /> </el-icon>\n-          上海不加班网络有限公司（https://bujiaban.com）\n-        </a>\n-        <!-- <br> -->\n+        <RouterLink\n+          to=\"https://bujiaban.com\"\n+          target=\"_blank\"\n+          :underline=\"false\"\n+        >\n+          <el-icon>\n+            <HomeFilled></HomeFilled>\n+          </el-icon>\n+          上海不加班网络有限公司(Apple Reality Spirit) |\n+        </RouterLink>\n         <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon><Document /></el-icon>\n-          沪ICP备15039333号\n+          <el-icon>\n+            <Grid></Grid>\n+          </el-icon>\n+          沪ICP备15039333号 |\n         </a>\n         <a href=\"#\">\n-          <el-icon><InfoFilled /></el-icon>\n-          2024\n+          <el-icon>\n+            <InfoFilled></InfoFilled>\n+          </el-icon>\n+          202408\n         </a>\n       </div>\n     </div>\n   </body>\n </template>\n \n <style scoped lang=\"scss\">\n body {\n+  position: fixed;\n+  display: flex;\n+  flex-direction: column;\n   height: 100%;\n   margin: 0;\n-  position: fixedg;\n }\n \n-body {\n-  display: flex;\n-  flex-direction: column;\n-}\n-\n .header,\n .footer {\n-  height: 7%;\n-  width: 100%;\n-  background-color: #f1f1f1;\n   position: relative;\n   display: flex;\n   align-items: center;\n+  width: 100%;\n+  height: 7%;\n   margin-right: 10px;\n+  background-color: #f1f1f1;\n }\n \n .logo {\n   position: absolute;\n   left: 10px;\n+\n   img {\n     width: 32px;\n     height: 32px;\n+    margin-left: 12px;\n     vertical-align: middle;\n-    margin-left: 12px;\n   }\n+\n   .project_title {\n     margin-left: 10px;\n-    color: #909399;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n     font-size: 14px;\n-    font-family: \"SourceHanSansSC-VF\";\n     font-weight: 400;\n+    color: #909399;\n   }\n }\n \n .blog {\n   position: absolute;\n+  height: 60px;\n   margin-left: 300px;\n-  height: 60px;\n+  font-size: 14px;\n+  font-weight: 400;\n   line-height: 60px;\n   color: #909399;\n-  font-size: 14px;\n-  font-family: \"SourceHanSansSC-VF\";\n-  font-weight: 400;\n+\n   &:hover {\n-    color: #000000;\n+    color: #000;\n   }\n }\n \n .header-right {\n@@ -225,24 +266,91 @@\n   right: 10px;\n }\n \n .content {\n+  display: flex;\n   flex: 1;\n+  align-items: center;\n+  justify-content: center;\n   width: 100%;\n-  background-image: url(\"/public/media/bg/02.jpg\");\n+  background-image: url(\"/media/bg/02.jpg\");\n   background-size: 100% auto;\n-  display: flex;\n-  align-items: center;\n-  justify-content: center;\n \n+  .box1 {\n+    display: flex;\n+    align-items: center;\n+    justify-content: center;\n+    width: 450px;\n+    height: 600px;\n+    background-color: #fff;\n+\n+    .box2 {\n+      display: flex;\n+      flex-direction: column;\n+      align-items: flex-start;\n+      width: 90%;\n+      height: 90%;\n+      padding: 25px;\n+      border: 1px solid #ebeefe;\n+      border-radius: 4px;\n+\n+      &:hover {\n+        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n+        transition: all 0.4s;\n+      }\n+\n+      h1 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 36px;\n+        font-weight: 400;\n+        color: #666;\n+      }\n+\n+      h4 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 18px;\n+        font-weight: 400;\n+        color: #494949;\n+      }\n+\n+      .box3 {\n+        align-self: center;\n+        width: 350px;\n+        height: 300px;\n+        margin-top: 20px;\n+        margin-bottom: 20px;\n+        background-color: #fff;\n+        border: 1px solid #ebeefe;\n+\n+        &:hover {\n+          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n+          transition: all 0.4s;\n+        }\n+      }\n+\n+      el-button {\n+        align-self: center;\n+        /* 水平居中 */\n+        margin-top: 2px;\n+        /* 上下间隔10px */\n+      }\n+    }\n+  }\n+\n   .login-title {\n     margin: 20px 0;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n     font-weight: bold;\n     color: #444;\n     text-align: center;\n   }\n \n-  .login-body {\n+  .login-form {\n     max-width: 100%;\n     height: 100%;\n     padding: 10px 40px 0 10px;\n     margin-top: 36px;\n@@ -257,40 +365,49 @@\n     margin-bottom: 20px;\n   }\n \n   .login-link a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n     font-size: 16px;\n     color: rgb(28 160 212);\n   }\n \n   .error-message {\n     margin-top: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n     color: red;\n     text-align: center;\n   }\n }\n \n .footer {\n-  text-align: center;\n+  margin: 0 30px;\n   font-size: 12px;\n-  margin: 0 30px;\n   line-height: 80px;\n+  text-align: center;\n+\n   .copyright {\n     position: absolute;\n     right: 10px;\n   }\n+\n   .copyright a {\n-    color: rgb(3, 3, 3);\n-    padding: 0 20px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n     font-size: 14px;\n+    color: rgb(3 3 3);\n   }\n+\n   .copyright a:hover {\n-    color: rgb(11, 175, 240);\n+    color: rgb(11 175 240);\n   }\n }\n+\n .fixed-footer {\n   position: fixed;\n   bottom: 0;\n+  z-index: 1;\n   width: 100%;\n-  z-index: 1;\n }\n </style>\n"
                },
                {
                    "date": 1725348964279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,413 @@\n+<script setup lang=\"ts\">\n+import \"@/assets/font/font.css\";\n+import { ref, computed } from \"vue\";\n+import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n+import { FormInstance } from \"element-plus\";\n+import { useUserStore } from \"@/store/modules/user\";\n+import { LoginData } from \"@/api/auth/model\";\n+import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n+import AuthAPI from \"@/api/auth/index\";\n+\n+const userStore = useUserStore();\n+const route = useRoute();\n+\n+const form = ref<LoginData>({\n+  username: \"huyuelong\",\n+  password: \"123456hu\",\n+});\n+\n+const rules = computed(() => {\n+  return {\n+    username: [\n+      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n+      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n+    ],\n+    password: [\n+      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n+      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n+    ],\n+  };\n+});\n+\n+const router = useRouter();\n+const formRef = ref<FormInstance>();\n+const isShow = ref(false);\n+const title = ref<string | Record<string, string>>(\"\");\n+\n+// 登录成功\n+const succeed = (data: any) => {\n+  ElMessage.success(\"登录成功\");\n+  const token = data.access_token;\n+  console.log(\"token:\", token);\n+  if (token) {\n+    setToken(token);\n+    const res = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", res);\n+    nextTick(() => {\n+      router.push(\"/\");\n+      console.log(\"Routing to home\"); // 确认路由跳转\n+    });\n+    // const { path, queryParams } = parseRedirect();\n+    // console.log(\"路由：\", path, queryParams);\n+    // router.push({ path: path, query: queryParams });\n+  } else {\n+    failed(\"登录响应中缺少 access_token\");\n+  }\n+};\n+\n+// 设置token\n+const setToken = (token: string) => {\n+  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n+};\n+\n+// 解析 redirect 字符串 为 path 和  queryParams\n+function parseRedirect(): {\n+  path: string;\n+  queryParams: Record<string, string>;\n+} {\n+  const query: LocationQuery = route.query;\n+  const redirect = (query.redirect as string) ?? \"/\";\n+\n+  const url = new URL(redirect, window.location.origin);\n+  const path = url.pathname;\n+  const queryParams: Record<string, string> = {};\n+\n+  url.searchParams.forEach((value, key) => {\n+    queryParams[key] = value;\n+  });\n+\n+  return { path, queryParams };\n+}\n+\n+// 登录失败\n+const failed = (message: any) => {\n+  error(message);\n+};\n+\n+const submit = () => {\n+  formRef.value?.validate(async (valid: boolean) => {\n+    if (valid) {\n+      try {\n+        const res = await AuthAPI.login(form.value);\n+        await succeed(res.data);\n+        const userin = await userStore.getUserInfo();\n+        console.log(\"userin:\", userin);\n+        const { path, queryParams } = await parseRedirect();\n+        console.log(\"path:\", path, \"queryParams:\", queryParams);\n+        await router.push({ path: path, query: queryParams });\n+      } catch (error) {\n+        failed(error);\n+      }\n+    } else {\n+      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n+    }\n+  });\n+};\n+\n+// 显示错误信息\n+const error = (msg: string | Record<string, string>) => {\n+  title.value =\n+    typeof msg === \"string\"\n+      ? msg\n+      : Object.keys(msg)\n+          .map((key) => `${key} : ${msg[key]}`)\n+          .join(\"\\n\");\n+  isShow.value = true;\n+};\n+</script>\n+\n+<template>\n+  <body>\n+    <div class=\"header\">\n+      <RouterLink to=\"/\" class=\"logo\">\n+        <img src=\"/favicon.ico\" alt=\"\" />\n+        <span class=\"project_title\">苹果AR元气项目</span>\n+      </RouterLink>\n+      <div class=\"header-right\">\n+        <el-button>平台注册/登录</el-button>\n+      </div>\n+      <div class=\"blog\">\n+        <a>开发博客</a>\n+      </div>\n+    </div>\n+    <div class=\"content\">\n+      <div class=\"box1\">\n+        <div class=\"box2\">\n+          <h1>欢迎!</h1>\n+          <h4>准备好出发了么？</h4>\n+          <div class=\"box3\">\n+            <h2 class=\"login-title\">登录账号</h2>\n+            <el-form\n+              ref=\"formRef\"\n+              class=\"login-form\"\n+              :rules=\"rules\"\n+              :model=\"form\"\n+              label-width=\"75px\"\n+            >\n+              <el-form-item label=\"用户名\" prop=\"username\">\n+                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n+              </el-form-item>\n+              <el-form-item label=\"密码\" prop=\"password\">\n+                <el-input\n+                  v-model=\"form.password\"\n+                  type=\"password\"\n+                  suffix-icon=\"Lock\"\n+                ></el-input>\n+              </el-form-item>\n+\n+              <el-form-item class=\"login-button\">\n+                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n+                  登录平台\n+                </el-button>\n+              </el-form-item>\n+            </el-form>\n+            <!-- <div class=\"login-link\">\n+          <router-link to=\"/site/signup\">\n+            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n+          </router-link>\n+          <br />\n+          <router-link to=\"/site/request-password-reset\">\n+            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n+          </router-link>\n+          <br />\n+        </div> -->\n+            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n+          </div>\n+          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n+        </div>\n+      </div>\n+    </div>\n+    <div class=\"footer\">\n+      <div class=\"copyright\">\n+        <RouterLink\n+          to=\"https://bujiaban.com\"\n+          target=\"_blank\"\n+          :underline=\"false\"\n+        >\n+          <el-icon>\n+            <HomeFilled></HomeFilled>\n+          </el-icon>\n+          上海不加班网络有限公司(Apple Reality Spirit) |\n+        </RouterLink>\n+        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+          <el-icon>\n+            <Grid></Grid>\n+          </el-icon>\n+          沪ICP备15039333号 |\n+        </a>\n+        <a href=\"#\">\n+          <el-icon>\n+            <InfoFilled></InfoFilled>\n+          </el-icon>\n+          202408\n+        </a>\n+      </div>\n+    </div>\n+  </body>\n+</template>\n+\n+<style scoped lang=\"scss\">\n+body {\n+  position: fixed;\n+  display: flex;\n+  flex-direction: column;\n+  height: 100%;\n+  margin: 0;\n+}\n+\n+.header,\n+.footer {\n+  position: relative;\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  height: 7%;\n+  margin-right: 10px;\n+  background-color: #f1f1f1;\n+}\n+\n+.logo {\n+  position: absolute;\n+  left: 10px;\n+\n+  img {\n+    width: 32px;\n+    height: 32px;\n+    margin-left: 12px;\n+    vertical-align: middle;\n+  }\n+\n+  .project_title {\n+    margin-left: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    font-weight: 400;\n+    color: #909399;\n+  }\n+}\n+\n+.blog {\n+  position: absolute;\n+  height: 60px;\n+  margin-left: 300px;\n+  font-size: 14px;\n+  font-weight: 400;\n+  line-height: 60px;\n+  color: #909399;\n+\n+  &:hover {\n+    color: #000;\n+  }\n+}\n+\n+.header-right {\n+  position: absolute;\n+  right: 10px;\n+}\n+\n+.content {\n+  display: flex;\n+  flex: 1;\n+  align-items: center;\n+  justify-content: center;\n+  width: 100%;\n+  background-image: url(\"/media/bg/02.jpg\");\n+  background-size: 100% auto;\n+\n+  .box1 {\n+    display: flex;\n+    align-items: center;\n+    justify-content: center;\n+    width: 450px;\n+    height: 600px;\n+    background-color: #fff;\n+\n+    .box2 {\n+      display: flex;\n+      flex-direction: column;\n+      align-items: flex-start;\n+      width: 90%;\n+      height: 90%;\n+      padding: 25px;\n+      border: 1px solid #ebeefe;\n+      border-radius: 4px;\n+\n+      &:hover {\n+        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n+        transition: all 0.4s;\n+      }\n+\n+      h1 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 36px;\n+        font-weight: 400;\n+        color: #666;\n+      }\n+\n+      h4 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 18px;\n+        font-weight: 400;\n+        color: #494949;\n+      }\n+\n+      .box3 {\n+        align-self: center;\n+        width: 350px;\n+        height: 300px;\n+        margin-top: 20px;\n+        margin-bottom: 20px;\n+        background-color: #fff;\n+        border: 1px solid #ebeefe;\n+\n+        &:hover {\n+          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n+          transition: all 0.4s;\n+        }\n+      }\n+\n+      el-button {\n+        align-self: center;\n+        /* 水平居中 */\n+        margin-top: 2px;\n+        /* 上下间隔10px */\n+      }\n+    }\n+  }\n+\n+  .login-title {\n+    margin: 20px 0;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-weight: bold;\n+    color: #444;\n+    text-align: center;\n+  }\n+\n+  .login-form {\n+    max-width: 100%;\n+    height: 100%;\n+    padding: 10px 40px 0 10px;\n+    margin-top: 36px;\n+  }\n+\n+  .login-button {\n+    text-align: right;\n+  }\n+\n+  .login-link {\n+    padding: 0 10px;\n+    margin-bottom: 20px;\n+  }\n+\n+  .login-link a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 16px;\n+    color: rgb(28 160 212);\n+  }\n+\n+  .error-message {\n+    margin-top: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    color: red;\n+    text-align: center;\n+  }\n+}\n+\n+.footer {\n+  margin: 0 30px;\n+  font-size: 12px;\n+  line-height: 80px;\n+  text-align: center;\n+\n+  .copyright {\n+    position: absolute;\n+    right: 10px;\n+  }\n+\n+  .copyright a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    color: rgb(3 3 3);\n+  }\n+\n+  .copyright a:hover {\n+    color: rgb(11 175 240);\n+  }\n+}\n+\n+.fixed-footer {\n+  position: fixed;\n+  bottom: 0;\n+  z-index: 1;\n+  width: 100%;\n+}\n+</style>\n"
                },
                {
                    "date": 1725349015150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,414 @@\n+<script setup lang=\"ts\">\n+import \"@/assets/font/font.css\";\n+import { ref, computed } from \"vue\";\n+import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n+import { FormInstance } from \"element-plus\";\n+import { useUserStore } from \"@/store/modules/user\";\n+import { LoginData } from \"@/api/auth/model\";\n+import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n+import AuthAPI from \"@/api/auth/index\";\n+\n+const userStore = useUserStore();\n+const route = useRoute();\n+\n+const form = ref<LoginData>({\n+  username: \"huyuelong\",\n+  password: \"123456hu\",\n+});\n+\n+const rules = computed(() => {\n+  return {\n+    username: [\n+      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n+      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n+    ],\n+    password: [\n+      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n+      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n+    ],\n+  };\n+});\n+\n+const router = useRouter();\n+const formRef = ref<FormInstance>();\n+const isShow = ref(false);\n+const title = ref<string | Record<string, string>>(\"\");\n+\n+// 登录成功\n+const succeed = (data: any) => {\n+  ElMessage.success(\"登录成功\");\n+  const token = data.access_token;\n+  console.log(\"token:\", token);\n+  if (token) {\n+    setToken(token);\n+    const res = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", res);\n+\n+    nextTick(() => {\n+      router.push(\"/\");\n+      console.log(\"Routing to home\"); // 确认路由跳转\n+    });\n+    // const { path, queryParams } = parseRedirect();\n+    // console.log(\"路由：\", path, queryParams);\n+    // router.push({ path: path, query: queryParams });\n+  } else {\n+    failed(\"登录响应中缺少 access_token\");\n+  }\n+};\n+\n+// 设置token\n+const setToken = (token: string) => {\n+  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n+};\n+\n+// 解析 redirect 字符串 为 path 和  queryParams\n+function parseRedirect(): {\n+  path: string;\n+  queryParams: Record<string, string>;\n+} {\n+  const query: LocationQuery = route.query;\n+  const redirect = (query.redirect as string) ?? \"/\";\n+\n+  const url = new URL(redirect, window.location.origin);\n+  const path = url.pathname;\n+  const queryParams: Record<string, string> = {};\n+\n+  url.searchParams.forEach((value, key) => {\n+    queryParams[key] = value;\n+  });\n+\n+  return { path, queryParams };\n+}\n+\n+// 登录失败\n+const failed = (message: any) => {\n+  error(message);\n+};\n+\n+const submit = () => {\n+  formRef.value?.validate(async (valid: boolean) => {\n+    if (valid) {\n+      try {\n+        const res = await AuthAPI.login(form.value);\n+        await succeed(res.data);\n+        const userin = await userStore.getUserInfo();\n+        console.log(\"userin:\", userin);\n+        const { path, queryParams } = await parseRedirect();\n+        console.log(\"path:\", path, \"queryParams:\", queryParams);\n+        await router.push({ path: path, query: queryParams });\n+      } catch (error) {\n+        failed(error);\n+      }\n+    } else {\n+      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n+    }\n+  });\n+};\n+\n+// 显示错误信息\n+const error = (msg: string | Record<string, string>) => {\n+  title.value =\n+    typeof msg === \"string\"\n+      ? msg\n+      : Object.keys(msg)\n+          .map((key) => `${key} : ${msg[key]}`)\n+          .join(\"\\n\");\n+  isShow.value = true;\n+};\n+</script>\n+\n+<template>\n+  <body>\n+    <div class=\"header\">\n+      <RouterLink to=\"/\" class=\"logo\">\n+        <img src=\"/favicon.ico\" alt=\"\" />\n+        <span class=\"project_title\">苹果AR元气项目</span>\n+      </RouterLink>\n+      <div class=\"header-right\">\n+        <el-button>平台注册/登录</el-button>\n+      </div>\n+      <div class=\"blog\">\n+        <a>开发博客</a>\n+      </div>\n+    </div>\n+    <div class=\"content\">\n+      <div class=\"box1\">\n+        <div class=\"box2\">\n+          <h1>欢迎!</h1>\n+          <h4>准备好出发了么？</h4>\n+          <div class=\"box3\">\n+            <h2 class=\"login-title\">登录账号</h2>\n+            <el-form\n+              ref=\"formRef\"\n+              class=\"login-form\"\n+              :rules=\"rules\"\n+              :model=\"form\"\n+              label-width=\"75px\"\n+            >\n+              <el-form-item label=\"用户名\" prop=\"username\">\n+                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n+              </el-form-item>\n+              <el-form-item label=\"密码\" prop=\"password\">\n+                <el-input\n+                  v-model=\"form.password\"\n+                  type=\"password\"\n+                  suffix-icon=\"Lock\"\n+                ></el-input>\n+              </el-form-item>\n+\n+              <el-form-item class=\"login-button\">\n+                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n+                  登录平台\n+                </el-button>\n+              </el-form-item>\n+            </el-form>\n+            <!-- <div class=\"login-link\">\n+          <router-link to=\"/site/signup\">\n+            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n+          </router-link>\n+          <br />\n+          <router-link to=\"/site/request-password-reset\">\n+            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n+          </router-link>\n+          <br />\n+        </div> -->\n+            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n+          </div>\n+          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n+        </div>\n+      </div>\n+    </div>\n+    <div class=\"footer\">\n+      <div class=\"copyright\">\n+        <RouterLink\n+          to=\"https://bujiaban.com\"\n+          target=\"_blank\"\n+          :underline=\"false\"\n+        >\n+          <el-icon>\n+            <HomeFilled></HomeFilled>\n+          </el-icon>\n+          上海不加班网络有限公司(Apple Reality Spirit) |\n+        </RouterLink>\n+        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+          <el-icon>\n+            <Grid></Grid>\n+          </el-icon>\n+          沪ICP备15039333号 |\n+        </a>\n+        <a href=\"#\">\n+          <el-icon>\n+            <InfoFilled></InfoFilled>\n+          </el-icon>\n+          202408\n+        </a>\n+      </div>\n+    </div>\n+  </body>\n+</template>\n+\n+<style scoped lang=\"scss\">\n+body {\n+  position: fixed;\n+  display: flex;\n+  flex-direction: column;\n+  height: 100%;\n+  margin: 0;\n+}\n+\n+.header,\n+.footer {\n+  position: relative;\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  height: 7%;\n+  margin-right: 10px;\n+  background-color: #f1f1f1;\n+}\n+\n+.logo {\n+  position: absolute;\n+  left: 10px;\n+\n+  img {\n+    width: 32px;\n+    height: 32px;\n+    margin-left: 12px;\n+    vertical-align: middle;\n+  }\n+\n+  .project_title {\n+    margin-left: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    font-weight: 400;\n+    color: #909399;\n+  }\n+}\n+\n+.blog {\n+  position: absolute;\n+  height: 60px;\n+  margin-left: 300px;\n+  font-size: 14px;\n+  font-weight: 400;\n+  line-height: 60px;\n+  color: #909399;\n+\n+  &:hover {\n+    color: #000;\n+  }\n+}\n+\n+.header-right {\n+  position: absolute;\n+  right: 10px;\n+}\n+\n+.content {\n+  display: flex;\n+  flex: 1;\n+  align-items: center;\n+  justify-content: center;\n+  width: 100%;\n+  background-image: url(\"/media/bg/02.jpg\");\n+  background-size: 100% auto;\n+\n+  .box1 {\n+    display: flex;\n+    align-items: center;\n+    justify-content: center;\n+    width: 450px;\n+    height: 600px;\n+    background-color: #fff;\n+\n+    .box2 {\n+      display: flex;\n+      flex-direction: column;\n+      align-items: flex-start;\n+      width: 90%;\n+      height: 90%;\n+      padding: 25px;\n+      border: 1px solid #ebeefe;\n+      border-radius: 4px;\n+\n+      &:hover {\n+        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n+        transition: all 0.4s;\n+      }\n+\n+      h1 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 36px;\n+        font-weight: 400;\n+        color: #666;\n+      }\n+\n+      h4 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 18px;\n+        font-weight: 400;\n+        color: #494949;\n+      }\n+\n+      .box3 {\n+        align-self: center;\n+        width: 350px;\n+        height: 300px;\n+        margin-top: 20px;\n+        margin-bottom: 20px;\n+        background-color: #fff;\n+        border: 1px solid #ebeefe;\n+\n+        &:hover {\n+          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n+          transition: all 0.4s;\n+        }\n+      }\n+\n+      el-button {\n+        align-self: center;\n+        /* 水平居中 */\n+        margin-top: 2px;\n+        /* 上下间隔10px */\n+      }\n+    }\n+  }\n+\n+  .login-title {\n+    margin: 20px 0;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-weight: bold;\n+    color: #444;\n+    text-align: center;\n+  }\n+\n+  .login-form {\n+    max-width: 100%;\n+    height: 100%;\n+    padding: 10px 40px 0 10px;\n+    margin-top: 36px;\n+  }\n+\n+  .login-button {\n+    text-align: right;\n+  }\n+\n+  .login-link {\n+    padding: 0 10px;\n+    margin-bottom: 20px;\n+  }\n+\n+  .login-link a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 16px;\n+    color: rgb(28 160 212);\n+  }\n+\n+  .error-message {\n+    margin-top: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    color: red;\n+    text-align: center;\n+  }\n+}\n+\n+.footer {\n+  margin: 0 30px;\n+  font-size: 12px;\n+  line-height: 80px;\n+  text-align: center;\n+\n+  .copyright {\n+    position: absolute;\n+    right: 10px;\n+  }\n+\n+  .copyright a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    color: rgb(3 3 3);\n+  }\n+\n+  .copyright a:hover {\n+    color: rgb(11 175 240);\n+  }\n+}\n+\n+.fixed-footer {\n+  position: fixed;\n+  bottom: 0;\n+  z-index: 1;\n+  width: 100%;\n+}\n+</style>\n"
                },
                {
                    "date": 1725350174490,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -411,830 +411,4 @@\n   z-index: 1;\n   width: 100%;\n }\n </style>\n-<script setup lang=\"ts\">\n-import \"@/assets/font/font.css\";\n-import { ref, computed } from \"vue\";\n-import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n-import { FormInstance } from \"element-plus\";\n-import { useUserStore } from \"@/store/modules/user\";\n-import { LoginData } from \"@/api/auth/model\";\n-import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n-import AuthAPI from \"@/api/auth/index\";\n-\n-const userStore = useUserStore();\n-const route = useRoute();\n-\n-const form = ref<LoginData>({\n-  username: \"huyuelong\",\n-  password: \"123456hu\",\n-});\n-\n-const rules = computed(() => {\n-  return {\n-    username: [\n-      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n-      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n-    ],\n-    password: [\n-      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n-      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n-    ],\n-  };\n-});\n-\n-const router = useRouter();\n-const formRef = ref<FormInstance>();\n-const isShow = ref(false);\n-const title = ref<string | Record<string, string>>(\"\");\n-\n-// 登录成功\n-const succeed = (data: any) => {\n-  ElMessage.success(\"登录成功\");\n-  const token = data.access_token;\n-  console.log(\"token:\", token);\n-  if (token) {\n-    setToken(token);\n-    const res = localStorage.getItem(TOKEN_KEY);\n-    console.log(\"Token set successfully\", res);\n-    nextTick(() => {\n-      router.push(\"/\");\n-      console.log(\"Routing to home\"); // 确认路由跳转\n-    });\n-    // const { path, queryParams } = parseRedirect();\n-    // console.log(\"路由：\", path, queryParams);\n-    // router.push({ path: path, query: queryParams });\n-  } else {\n-    failed(\"登录响应中缺少 access_token\");\n-  }\n-};\n-\n-// 设置token\n-const setToken = (token: string) => {\n-  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n-};\n-\n-// 解析 redirect 字符串 为 path 和  queryParams\n-function parseRedirect(): {\n-  path: string;\n-  queryParams: Record<string, string>;\n-} {\n-  const query: LocationQuery = route.query;\n-  const redirect = (query.redirect as string) ?? \"/\";\n-\n-  const url = new URL(redirect, window.location.origin);\n-  const path = url.pathname;\n-  const queryParams: Record<string, string> = {};\n-\n-  url.searchParams.forEach((value, key) => {\n-    queryParams[key] = value;\n-  });\n-\n-  return { path, queryParams };\n-}\n-\n-// 登录失败\n-const failed = (message: any) => {\n-  error(message);\n-};\n-\n-const submit = () => {\n-  formRef.value?.validate(async (valid: boolean) => {\n-    if (valid) {\n-      try {\n-        const res = await AuthAPI.login(form.value);\n-        await succeed(res.data);\n-        const userin = await userStore.getUserInfo();\n-        console.log(\"userin:\", userin);\n-        const { path, queryParams } = await parseRedirect();\n-        console.log(\"path:\", path, \"queryParams:\", queryParams);\n-        await router.push({ path: path, query: queryParams });\n-      } catch (error) {\n-        failed(error);\n-      }\n-    } else {\n-      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n-    }\n-  });\n-};\n-\n-// 显示错误信息\n-const error = (msg: string | Record<string, string>) => {\n-  title.value =\n-    typeof msg === \"string\"\n-      ? msg\n-      : Object.keys(msg)\n-          .map((key) => `${key} : ${msg[key]}`)\n-          .join(\"\\n\");\n-  isShow.value = true;\n-};\n-</script>\n-\n-<template>\n-  <body>\n-    <div class=\"header\">\n-      <RouterLink to=\"/\" class=\"logo\">\n-        <img src=\"/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">苹果AR元气项目</span>\n-      </RouterLink>\n-      <div class=\"header-right\">\n-        <el-button>平台注册/登录</el-button>\n-      </div>\n-      <div class=\"blog\">\n-        <a>开发博客</a>\n-      </div>\n-    </div>\n-    <div class=\"content\">\n-      <div class=\"box1\">\n-        <div class=\"box2\">\n-          <h1>欢迎!</h1>\n-          <h4>准备好出发了么？</h4>\n-          <div class=\"box3\">\n-            <h2 class=\"login-title\">登录账号</h2>\n-            <el-form\n-              ref=\"formRef\"\n-              class=\"login-form\"\n-              :rules=\"rules\"\n-              :model=\"form\"\n-              label-width=\"75px\"\n-            >\n-              <el-form-item label=\"用户名\" prop=\"username\">\n-                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n-              </el-form-item>\n-              <el-form-item label=\"密码\" prop=\"password\">\n-                <el-input\n-                  v-model=\"form.password\"\n-                  type=\"password\"\n-                  suffix-icon=\"Lock\"\n-                ></el-input>\n-              </el-form-item>\n-\n-              <el-form-item class=\"login-button\">\n-                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n-                  登录平台\n-                </el-button>\n-              </el-form-item>\n-            </el-form>\n-            <!-- <div class=\"login-link\">\n-          <router-link to=\"/site/signup\">\n-            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n-          </router-link>\n-          <br />\n-          <router-link to=\"/site/request-password-reset\">\n-            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n-          </router-link>\n-          <br />\n-        </div> -->\n-            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n-          </div>\n-          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n-        </div>\n-      </div>\n-    </div>\n-    <div class=\"footer\">\n-      <div class=\"copyright\">\n-        <RouterLink\n-          to=\"https://bujiaban.com\"\n-          target=\"_blank\"\n-          :underline=\"false\"\n-        >\n-          <el-icon>\n-            <HomeFilled></HomeFilled>\n-          </el-icon>\n-          上海不加班网络有限公司(Apple Reality Spirit) |\n-        </RouterLink>\n-        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon>\n-            <Grid></Grid>\n-          </el-icon>\n-          沪ICP备15039333号 |\n-        </a>\n-        <a href=\"#\">\n-          <el-icon>\n-            <InfoFilled></InfoFilled>\n-          </el-icon>\n-          202408\n-        </a>\n-      </div>\n-    </div>\n-  </body>\n-</template>\n-\n-<style scoped lang=\"scss\">\n-body {\n-  position: fixed;\n-  display: flex;\n-  flex-direction: column;\n-  height: 100%;\n-  margin: 0;\n-}\n-\n-.header,\n-.footer {\n-  position: relative;\n-  display: flex;\n-  align-items: center;\n-  width: 100%;\n-  height: 7%;\n-  margin-right: 10px;\n-  background-color: #f1f1f1;\n-}\n-\n-.logo {\n-  position: absolute;\n-  left: 10px;\n-\n-  img {\n-    width: 32px;\n-    height: 32px;\n-    margin-left: 12px;\n-    vertical-align: middle;\n-  }\n-\n-  .project_title {\n-    margin-left: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    font-weight: 400;\n-    color: #909399;\n-  }\n-}\n-\n-.blog {\n-  position: absolute;\n-  height: 60px;\n-  margin-left: 300px;\n-  font-size: 14px;\n-  font-weight: 400;\n-  line-height: 60px;\n-  color: #909399;\n-\n-  &:hover {\n-    color: #000;\n-  }\n-}\n-\n-.header-right {\n-  position: absolute;\n-  right: 10px;\n-}\n-\n-.content {\n-  display: flex;\n-  flex: 1;\n-  align-items: center;\n-  justify-content: center;\n-  width: 100%;\n-  background-image: url(\"/media/bg/02.jpg\");\n-  background-size: 100% auto;\n-\n-  .box1 {\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-    width: 450px;\n-    height: 600px;\n-    background-color: #fff;\n-\n-    .box2 {\n-      display: flex;\n-      flex-direction: column;\n-      align-items: flex-start;\n-      width: 90%;\n-      height: 90%;\n-      padding: 25px;\n-      border: 1px solid #ebeefe;\n-      border-radius: 4px;\n-\n-      &:hover {\n-        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n-        transition: all 0.4s;\n-      }\n-\n-      h1 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 36px;\n-        font-weight: 400;\n-        color: #666;\n-      }\n-\n-      h4 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 18px;\n-        font-weight: 400;\n-        color: #494949;\n-      }\n-\n-      .box3 {\n-        align-self: center;\n-        width: 350px;\n-        height: 300px;\n-        margin-top: 20px;\n-        margin-bottom: 20px;\n-        background-color: #fff;\n-        border: 1px solid #ebeefe;\n-\n-        &:hover {\n-          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n-          transition: all 0.4s;\n-        }\n-      }\n-\n-      el-button {\n-        align-self: center;\n-        /* 水平居中 */\n-        margin-top: 2px;\n-        /* 上下间隔10px */\n-      }\n-    }\n-  }\n-\n-  .login-title {\n-    margin: 20px 0;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-weight: bold;\n-    color: #444;\n-    text-align: center;\n-  }\n-\n-  .login-form {\n-    max-width: 100%;\n-    height: 100%;\n-    padding: 10px 40px 0 10px;\n-    margin-top: 36px;\n-  }\n-\n-  .login-button {\n-    text-align: right;\n-  }\n-\n-  .login-link {\n-    padding: 0 10px;\n-    margin-bottom: 20px;\n-  }\n-\n-  .login-link a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 16px;\n-    color: rgb(28 160 212);\n-  }\n-\n-  .error-message {\n-    margin-top: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    color: red;\n-    text-align: center;\n-  }\n-}\n-\n-.footer {\n-  margin: 0 30px;\n-  font-size: 12px;\n-  line-height: 80px;\n-  text-align: center;\n-\n-  .copyright {\n-    position: absolute;\n-    right: 10px;\n-  }\n-\n-  .copyright a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    color: rgb(3 3 3);\n-  }\n-\n-  .copyright a:hover {\n-    color: rgb(11 175 240);\n-  }\n-}\n-\n-.fixed-footer {\n-  position: fixed;\n-  bottom: 0;\n-  z-index: 1;\n-  width: 100%;\n-}\n-</style>\n-<script setup lang=\"ts\">\n-import \"@/assets/font/font.css\";\n-import { ref, computed } from \"vue\";\n-import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n-import { FormInstance } from \"element-plus\";\n-import { useUserStore } from \"@/store/modules/user\";\n-import { LoginData } from \"@/api/auth/model\";\n-import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n-import AuthAPI from \"@/api/auth/index\";\n-\n-const userStore = useUserStore();\n-const route = useRoute();\n-\n-const form = ref<LoginData>({\n-  username: \"huyuelong\",\n-  password: \"123456hu\",\n-});\n-\n-const rules = computed(() => {\n-  return {\n-    username: [\n-      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n-      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n-    ],\n-    password: [\n-      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n-      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n-    ],\n-  };\n-});\n-\n-const router = useRouter();\n-const formRef = ref<FormInstance>();\n-const isShow = ref(false);\n-const title = ref<string | Record<string, string>>(\"\");\n-\n-// 登录成功\n-const succeed = (data: any) => {\n-  ElMessage.success(\"登录成功\");\n-  const token = data.access_token;\n-  console.log(\"token:\", token);\n-  if (token) {\n-    setToken(token);\n-    const res = localStorage.getItem(TOKEN_KEY);\n-    console.log(\"Token set successfully\", res);\n-    nextTick(() => {\n-      router.push(\"/\");\n-      console.log(\"Routing to home\"); // 确认路由跳转\n-    });\n-    // const { path, queryParams } = parseRedirect();\n-    // console.log(\"路由：\", path, queryParams);\n-    // router.push({ path: path, query: queryParams });\n-  } else {\n-    failed(\"登录响应中缺少 access_token\");\n-  }\n-};\n-\n-// 设置token\n-const setToken = (token: string) => {\n-  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n-};\n-\n-// 解析 redirect 字符串 为 path 和  queryParams\n-function parseRedirect(): {\n-  path: string;\n-  queryParams: Record<string, string>;\n-} {\n-  const query: LocationQuery = route.query;\n-  const redirect = (query.redirect as string) ?? \"/\";\n-\n-  const url = new URL(redirect, window.location.origin);\n-  const path = url.pathname;\n-  const queryParams: Record<string, string> = {};\n-\n-  url.searchParams.forEach((value, key) => {\n-    queryParams[key] = value;\n-  });\n-\n-  return { path, queryParams };\n-}\n-\n-// 登录失败\n-const failed = (message: any) => {\n-  error(message);\n-};\n-\n-const submit = () => {\n-  formRef.value?.validate(async (valid: boolean) => {\n-    if (valid) {\n-      try {\n-        const res = await AuthAPI.login(form.value);\n-        await succeed(res.data);\n-        const userin = await userStore.getUserInfo();\n-        console.log(\"userin:\", userin);\n-        const { path, queryParams } = await parseRedirect();\n-        console.log(\"path:\", path, \"queryParams:\", queryParams);\n-        await router.push({ path: path, query: queryParams });\n-      } catch (error) {\n-        failed(error);\n-      }\n-    } else {\n-      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n-    }\n-  });\n-};\n-\n-// 显示错误信息\n-const error = (msg: string | Record<string, string>) => {\n-  title.value =\n-    typeof msg === \"string\"\n-      ? msg\n-      : Object.keys(msg)\n-          .map((key) => `${key} : ${msg[key]}`)\n-          .join(\"\\n\");\n-  isShow.value = true;\n-};\n-</script>\n-\n-<template>\n-  <body>\n-    <div class=\"header\">\n-      <RouterLink to=\"/\" class=\"logo\">\n-        <img src=\"/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">苹果AR元气项目</span>\n-      </RouterLink>\n-      <div class=\"header-right\">\n-        <el-button>平台注册/登录</el-button>\n-      </div>\n-      <div class=\"blog\">\n-        <a>开发博客</a>\n-      </div>\n-    </div>\n-    <div class=\"content\">\n-      <div class=\"box1\">\n-        <div class=\"box2\">\n-          <h1>欢迎!</h1>\n-          <h4>准备好出发了么？</h4>\n-          <div class=\"box3\">\n-            <h2 class=\"login-title\">登录账号</h2>\n-            <el-form\n-              ref=\"formRef\"\n-              class=\"login-form\"\n-              :rules=\"rules\"\n-              :model=\"form\"\n-              label-width=\"75px\"\n-            >\n-              <el-form-item label=\"用户名\" prop=\"username\">\n-                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n-              </el-form-item>\n-              <el-form-item label=\"密码\" prop=\"password\">\n-                <el-input\n-                  v-model=\"form.password\"\n-                  type=\"password\"\n-                  suffix-icon=\"Lock\"\n-                ></el-input>\n-              </el-form-item>\n-\n-              <el-form-item class=\"login-button\">\n-                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n-                  登录平台\n-                </el-button>\n-              </el-form-item>\n-            </el-form>\n-            <!-- <div class=\"login-link\">\n-          <router-link to=\"/site/signup\">\n-            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n-          </router-link>\n-          <br />\n-          <router-link to=\"/site/request-password-reset\">\n-            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n-          </router-link>\n-          <br />\n-        </div> -->\n-            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n-          </div>\n-          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n-        </div>\n-      </div>\n-    </div>\n-    <div class=\"footer\">\n-      <div class=\"copyright\">\n-        <RouterLink\n-          to=\"https://bujiaban.com\"\n-          target=\"_blank\"\n-          :underline=\"false\"\n-        >\n-          <el-icon>\n-            <HomeFilled></HomeFilled>\n-          </el-icon>\n-          上海不加班网络有限公司(Apple Reality Spirit) |\n-        </RouterLink>\n-        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon>\n-            <Grid></Grid>\n-          </el-icon>\n-          沪ICP备15039333号 |\n-        </a>\n-        <a href=\"#\">\n-          <el-icon>\n-            <InfoFilled></InfoFilled>\n-          </el-icon>\n-          202408\n-        </a>\n-      </div>\n-    </div>\n-  </body>\n-</template>\n-\n-<style scoped lang=\"scss\">\n-body {\n-  position: fixed;\n-  display: flex;\n-  flex-direction: column;\n-  height: 100%;\n-  margin: 0;\n-}\n-\n-.header,\n-.footer {\n-  position: relative;\n-  display: flex;\n-  align-items: center;\n-  width: 100%;\n-  height: 7%;\n-  margin-right: 10px;\n-  background-color: #f1f1f1;\n-}\n-\n-.logo {\n-  position: absolute;\n-  left: 10px;\n-\n-  img {\n-    width: 32px;\n-    height: 32px;\n-    margin-left: 12px;\n-    vertical-align: middle;\n-  }\n-\n-  .project_title {\n-    margin-left: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    font-weight: 400;\n-    color: #909399;\n-  }\n-}\n-\n-.blog {\n-  position: absolute;\n-  height: 60px;\n-  margin-left: 300px;\n-  font-size: 14px;\n-  font-weight: 400;\n-  line-height: 60px;\n-  color: #909399;\n-\n-  &:hover {\n-    color: #000;\n-  }\n-}\n-\n-.header-right {\n-  position: absolute;\n-  right: 10px;\n-}\n-\n-.content {\n-  display: flex;\n-  flex: 1;\n-  align-items: center;\n-  justify-content: center;\n-  width: 100%;\n-  background-image: url(\"/media/bg/02.jpg\");\n-  background-size: 100% auto;\n-\n-  .box1 {\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-    width: 450px;\n-    height: 600px;\n-    background-color: #fff;\n-\n-    .box2 {\n-      display: flex;\n-      flex-direction: column;\n-      align-items: flex-start;\n-      width: 90%;\n-      height: 90%;\n-      padding: 25px;\n-      border: 1px solid #ebeefe;\n-      border-radius: 4px;\n-\n-      &:hover {\n-        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n-        transition: all 0.4s;\n-      }\n-\n-      h1 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 36px;\n-        font-weight: 400;\n-        color: #666;\n-      }\n-\n-      h4 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 18px;\n-        font-weight: 400;\n-        color: #494949;\n-      }\n-\n-      .box3 {\n-        align-self: center;\n-        width: 350px;\n-        height: 300px;\n-        margin-top: 20px;\n-        margin-bottom: 20px;\n-        background-color: #fff;\n-        border: 1px solid #ebeefe;\n-\n-        &:hover {\n-          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n-          transition: all 0.4s;\n-        }\n-      }\n-\n-      el-button {\n-        align-self: center;\n-        /* 水平居中 */\n-        margin-top: 2px;\n-        /* 上下间隔10px */\n-      }\n-    }\n-  }\n-\n-  .login-title {\n-    margin: 20px 0;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-weight: bold;\n-    color: #444;\n-    text-align: center;\n-  }\n-\n-  .login-form {\n-    max-width: 100%;\n-    height: 100%;\n-    padding: 10px 40px 0 10px;\n-    margin-top: 36px;\n-  }\n-\n-  .login-button {\n-    text-align: right;\n-  }\n-\n-  .login-link {\n-    padding: 0 10px;\n-    margin-bottom: 20px;\n-  }\n-\n-  .login-link a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 16px;\n-    color: rgb(28 160 212);\n-  }\n-\n-  .error-message {\n-    margin-top: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    color: red;\n-    text-align: center;\n-  }\n-}\n-\n-.footer {\n-  margin: 0 30px;\n-  font-size: 12px;\n-  line-height: 80px;\n-  text-align: center;\n-\n-  .copyright {\n-    position: absolute;\n-    right: 10px;\n-  }\n-\n-  .copyright a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    color: rgb(3 3 3);\n-  }\n-\n-  .copyright a:hover {\n-    color: rgb(11 175 240);\n-  }\n-}\n-\n-.fixed-footer {\n-  position: fixed;\n-  bottom: 0;\n-  z-index: 1;\n-  width: 100%;\n-}\n-</style>\n"
                },
                {
                    "date": 1725350187588,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,8 +89,9 @@\n   formRef.value?.validate(async (valid: boolean) => {\n     if (valid) {\n       try {\n         const res = await AuthAPI.login(form.value);\n+        alert(JSON.stringify(res.data));\n         await succeed(res.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n         const { path, queryParams } = await parseRedirect();\n"
                },
                {
                    "date": 1725350236985,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,11 +88,11 @@\n const submit = () => {\n   formRef.value?.validate(async (valid: boolean) => {\n     if (valid) {\n       try {\n-        const res = await AuthAPI.login(form.value);\n-        alert(JSON.stringify(res.data));\n-        await succeed(res.data);\n+        const response = await AuthAPI.login(form.value);\n+        alert(JSON.stringify(response.data));\n+        await succeed(response.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n         const { path, queryParams } = await parseRedirect();\n         console.log(\"path:\", path, \"queryParams:\", queryParams);\n"
                },
                {
                    "date": 1725350261662,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,10 +40,10 @@\n   const token = data.access_token;\n   console.log(\"token:\", token);\n   if (token) {\n     setToken(token);\n-    const res = localStorage.getItem(TOKEN_KEY);\n-    console.log(\"Token set successfully\", res);\n+    const response = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", response);\n \n     nextTick(() => {\n       router.push(\"/\");\n       console.log(\"Routing to home\"); // 确认路由跳转\n@@ -89,9 +89,9 @@\n   formRef.value?.validate(async (valid: boolean) => {\n     if (valid) {\n       try {\n         const response = await AuthAPI.login(form.value);\n-        alert(JSON.stringify(response.data));\n+        //  alert(JSON.stringify(response.data));\n         await succeed(response.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n         const { path, queryParams } = await parseRedirect();\n"
                },
                {
                    "date": 1725357830287,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,22 +1,44 @@\n <script setup lang=\"ts\">\n import \"@/assets/font/font.css\";\n-import { ref, computed } from \"vue\";\n+import { ref, computed, nextTick, onMounted } from \"vue\";\n import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n import { FormInstance } from \"element-plus\";\n import { useUserStore } from \"@/store/modules/user\";\n import { LoginData } from \"@/api/auth/model\";\n import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n import AuthAPI from \"@/api/auth/index\";\n+import { initRoutes } from \"@/router\";\n+import CryptoJS from \"crypto-js\";\n \n+const secretKey = \"bujiaban\"; // 密钥\n+\n const userStore = useUserStore();\n const route = useRoute();\n \n const form = ref<LoginData>({\n-  username: \"huyuelong\",\n-  password: \"123456hu\",\n+  username: \"\",\n+  password: \"\",\n });\n \n+// 加密\n+const encryptedPassword = (password: string): string => {\n+  return CryptoJS.AES.encrypt(password, secretKey).toString();\n+};\n+// 解密\n+const decryptPassword = (encryptedPassword: string): string => {\n+  const bytes = CryptoJS.AES.decrypt(encryptedPassword, secretKey);\n+  return bytes.toString(CryptoJS.enc.Utf8);\n+};\n+\n+// 保存用户数据到本地\n+const saveLoginData = () => {\n+  const expirationTime = Date.now() + 24 * 60 * 60 * 1000; // 24小时有效\n+  localStorage.setItem(\"username\", form.value.username);\n+  localStorage.setItem(\"password\", encryptedPassword(form.value.password));\n+  localStorage.setItem(\"expirationTime\", expirationTime.toString());\n+};\n+\n const rules = computed(() => {\n   return {\n     username: [\n       { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n@@ -33,36 +55,29 @@\n const formRef = ref<FormInstance>();\n const isShow = ref(false);\n const title = ref<string | Record<string, string>>(\"\");\n \n-// 登录成功\n const succeed = (data: any) => {\n   ElMessage.success(\"登录成功\");\n   const token = data.access_token;\n-  console.log(\"token:\", token);\n   if (token) {\n     setToken(token);\n-    const response = localStorage.getItem(TOKEN_KEY);\n-    console.log(\"Token set successfully\", response);\n-\n+    saveLoginData();\n+    const res = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", res);\n     nextTick(() => {\n       router.push(\"/\");\n-      console.log(\"Routing to home\"); // 确认路由跳转\n+      console.log(\"Routing to home\");\n     });\n-    // const { path, queryParams } = parseRedirect();\n-    // console.log(\"路由：\", path, queryParams);\n-    // router.push({ path: path, query: queryParams });\n   } else {\n     failed(\"登录响应中缺少 access_token\");\n   }\n };\n \n-// 设置token\n const setToken = (token: string) => {\n   localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n };\n \n-// 解析 redirect 字符串 为 path 和  queryParams\n function parseRedirect(): {\n   path: string;\n   queryParams: Record<string, string>;\n } {\n@@ -79,20 +94,20 @@\n \n   return { path, queryParams };\n }\n \n-// 登录失败\n const failed = (message: any) => {\n   error(message);\n };\n \n const submit = () => {\n   formRef.value?.validate(async (valid: boolean) => {\n     if (valid) {\n       try {\n-        const response = await AuthAPI.login(form.value);\n-        //  alert(JSON.stringify(response.data));\n-        await succeed(response.data);\n+        const res = await AuthAPI.login(form.value);\n+        await initRoutes();\n+        await window.location.reload();\n+        await succeed(res.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n         const { path, queryParams } = await parseRedirect();\n         console.log(\"path:\", path, \"queryParams:\", queryParams);\n@@ -105,9 +120,8 @@\n     }\n   });\n };\n \n-// 显示错误信息\n const error = (msg: string | Record<string, string>) => {\n   title.value =\n     typeof msg === \"string\"\n       ? msg\n@@ -115,8 +129,31 @@\n           .map((key) => `${key} : ${msg[key]}`)\n           .join(\"\\n\");\n   isShow.value = true;\n };\n+\n+onMounted(() => {\n+  const savedUsername = localStorage.getItem(\"username\");\n+  const savedPassword = localStorage.getItem(\"password\");\n+  const savedExpirationTime = localStorage.getItem(\"expirationTime\");\n+\n+  if (savedExpirationTime) {\n+    const expirationTime = parseInt(savedExpirationTime, 10);\n+    if (Date.now() > expirationTime) {\n+      // 密码已过期，清除保存的密码\n+      // localStorage.removeItem(\"username\");\n+      localStorage.removeItem(\"password\");\n+      localStorage.removeItem(\"expirationTime\");\n+    } else {\n+      if (savedUsername) {\n+        form.value.username = savedUsername;\n+      }\n+      if (savedPassword) {\n+        form.value.password = decryptPassword(savedPassword);\n+      }\n+    }\n+  }\n+});\n </script>\n \n <template>\n   <body>\n@@ -172,9 +209,9 @@\n             <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n           </router-link>\n           <br />\n         </div> -->\n-            <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n+            <!-- <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div> -->\n           </div>\n           <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n         </div>\n       </div>\n"
                },
                {
                    "date": 1725418515523,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,452 @@\n+<script setup lang=\"ts\">\n+import \"@/assets/font/font.css\";\n+import { ref, computed, nextTick, onMounted } from \"vue\";\n+import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n+import { FormInstance } from \"element-plus\";\n+import { useUserStore } from \"@/store/modules/user\";\n+import { LoginData } from \"@/api/auth/model\";\n+import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n+import AuthAPI from \"@/api/auth/index\";\n+import { initRoutes, initRoutes } from \"@/router\";\n+import CryptoJS from \"crypto-js\";\n+\n+const secretKey = \"bujiaban\"; // 密钥\n+\n+const userStore = useUserStore();\n+const route = useRoute();\n+\n+const form = ref<LoginData>({\n+  username: \"\",\n+  password: \"\",\n+});\n+\n+// 加密\n+const encryptedPassword = (password: string): string => {\n+  return CryptoJS.AES.encrypt(password, secretKey).toString();\n+};\n+// 解密\n+const decryptPassword = (encryptedPassword: string): string => {\n+  const bytes = CryptoJS.AES.decrypt(encryptedPassword, secretKey);\n+  return bytes.toString(CryptoJS.enc.Utf8);\n+};\n+\n+// 保存用户数据到本地\n+const saveLoginData = () => {\n+  const expirationTime = Date.now() + 24 * 60 * 60 * 1000; // 24小时有效\n+  localStorage.setItem(\"username\", form.value.username);\n+  localStorage.setItem(\"password\", encryptedPassword(form.value.password));\n+  localStorage.setItem(\"expirationTime\", expirationTime.toString());\n+};\n+\n+const rules = computed(() => {\n+  return {\n+    username: [\n+      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n+      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n+    ],\n+    password: [\n+      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n+      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n+    ],\n+  };\n+});\n+\n+const router = useRouter();\n+const formRef = ref<FormInstance>();\n+const isShow = ref(false);\n+const title = ref<string | Record<string, string>>(\"\");\n+\n+const succeed = (data: any) => {\n+  ElMessage.success(\"登录成功\");\n+  const token = data.access_token;\n+  if (token) {\n+    setToken(token);\n+    saveLoginData();\n+    const res = localStorage.getItem(TOKEN_KEY);\n+    console.log(\"Token set successfully\", res);\n+    nextTick(() => {\n+      router.push(\"/\");\n+      console.log(\"Routing to home\");\n+    });\n+  } else {\n+    failed(\"登录响应中缺少 access_token\");\n+  }\n+};\n+\n+const setToken = (token: string) => {\n+  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n+};\n+\n+function parseRedirect(): {\n+  path: string;\n+  queryParams: Record<string, string>;\n+} {\n+  const query: LocationQuery = route.query;\n+  const redirect = (query.redirect as string) ?? \"/\";\n+\n+  const url = new URL(redirect, window.location.origin);\n+  const path = url.pathname;\n+  const queryParams: Record<string, string> = {};\n+\n+  url.searchParams.forEach((value, key) => {\n+    queryParams[key] = value;\n+  });\n+\n+  return { path, queryParams };\n+}\n+\n+const failed = (message: any) => {\n+  error(message);\n+};\n+\n+const submit = () => {\n+  formRef.value?.validate(async (valid: boolean) => {\n+    if (valid) {\n+      try {\n+        const res = await AuthAPI.login(form.value);\n+        await initRoutes();\n+        await window.location.reload();\n+        await succeed(res.data);\n+        const userin = await userStore.getUserInfo();\n+        console.log(\"userin:\", userin);\n+        const { path, queryParams } = await parseRedirect();\n+        console.log(\"path:\", path, \"queryParams:\", queryParams);\n+        await router.push({ path: path, query: queryParams });\n+      } catch (error) {\n+        failed(error);\n+      }\n+    } else {\n+      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n+    }\n+  });\n+};\n+\n+const error = (msg: string | Record<string, string>) => {\n+  title.value =\n+    typeof msg === \"string\"\n+      ? msg\n+      : Object.keys(msg)\n+          .map((key) => `${key} : ${msg[key]}`)\n+          .join(\"\\n\");\n+  isShow.value = true;\n+};\n+\n+onMounted(() => {\n+  const savedUsername = localStorage.getItem(\"username\");\n+  const savedPassword = localStorage.getItem(\"password\");\n+  const savedExpirationTime = localStorage.getItem(\"expirationTime\");\n+\n+  if (savedExpirationTime) {\n+    const expirationTime = parseInt(savedExpirationTime, 10);\n+    if (Date.now() > expirationTime) {\n+      // 密码已过期，清除保存的密码\n+      // localStorage.removeItem(\"username\");\n+      localStorage.removeItem(\"password\");\n+      localStorage.removeItem(\"expirationTime\");\n+    } else {\n+      if (savedUsername) {\n+        form.value.username = savedUsername;\n+      }\n+      if (savedPassword) {\n+        form.value.password = decryptPassword(savedPassword);\n+      }\n+    }\n+  }\n+});\n+</script>\n+\n+<template>\n+  <body>\n+    <div class=\"header\">\n+      <RouterLink to=\"/\" class=\"logo\">\n+        <img src=\"/favicon.ico\" alt=\"\" />\n+        <span class=\"project_title\">苹果AR元气项目</span>\n+      </RouterLink>\n+      <div class=\"header-right\">\n+        <el-button>平台注册/登录</el-button>\n+      </div>\n+      <div class=\"blog\">\n+        <a>开发博客</a>\n+      </div>\n+    </div>\n+    <div class=\"content\">\n+      <div class=\"box1\">\n+        <div class=\"box2\">\n+          <h1>欢迎!</h1>\n+          <h4>准备好出发了么？</h4>\n+          <div class=\"box3\">\n+            <h2 class=\"login-title\">登录账号</h2>\n+            <el-form\n+              ref=\"formRef\"\n+              class=\"login-form\"\n+              :rules=\"rules\"\n+              :model=\"form\"\n+              label-width=\"75px\"\n+            >\n+              <el-form-item label=\"用户名\" prop=\"username\">\n+                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n+              </el-form-item>\n+              <el-form-item label=\"密码\" prop=\"password\">\n+                <el-input\n+                  v-model=\"form.password\"\n+                  type=\"password\"\n+                  suffix-icon=\"Lock\"\n+                ></el-input>\n+              </el-form-item>\n+\n+              <el-form-item class=\"login-button\">\n+                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n+                  登录平台\n+                </el-button>\n+              </el-form-item>\n+            </el-form>\n+            <!-- <div class=\"login-link\">\n+          <router-link to=\"/site/signup\">\n+            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n+          </router-link>\n+          <br />\n+          <router-link to=\"/site/request-password-reset\">\n+            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n+          </router-link>\n+          <br />\n+        </div> -->\n+            <!-- <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div> -->\n+          </div>\n+          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n+        </div>\n+      </div>\n+    </div>\n+    <div class=\"footer\">\n+      <div class=\"copyright\">\n+        <RouterLink\n+          to=\"https://bujiaban.com\"\n+          target=\"_blank\"\n+          :underline=\"false\"\n+        >\n+          <el-icon>\n+            <HomeFilled></HomeFilled>\n+          </el-icon>\n+          上海不加班网络有限公司(Apple Reality Spirit) |\n+        </RouterLink>\n+        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n+          <el-icon>\n+            <Grid></Grid>\n+          </el-icon>\n+          沪ICP备15039333号 |\n+        </a>\n+        <a href=\"#\">\n+          <el-icon>\n+            <InfoFilled></InfoFilled>\n+          </el-icon>\n+          202408\n+        </a>\n+      </div>\n+    </div>\n+  </body>\n+</template>\n+\n+<style scoped lang=\"scss\">\n+body {\n+  position: fixed;\n+  display: flex;\n+  flex-direction: column;\n+  height: 100%;\n+  margin: 0;\n+}\n+\n+.header,\n+.footer {\n+  position: relative;\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  height: 7%;\n+  margin-right: 10px;\n+  background-color: #f1f1f1;\n+}\n+\n+.logo {\n+  position: absolute;\n+  left: 10px;\n+\n+  img {\n+    width: 32px;\n+    height: 32px;\n+    margin-left: 12px;\n+    vertical-align: middle;\n+  }\n+\n+  .project_title {\n+    margin-left: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    font-weight: 400;\n+    color: #909399;\n+  }\n+}\n+\n+.blog {\n+  position: absolute;\n+  height: 60px;\n+  margin-left: 300px;\n+  font-size: 14px;\n+  font-weight: 400;\n+  line-height: 60px;\n+  color: #909399;\n+\n+  &:hover {\n+    color: #000;\n+  }\n+}\n+\n+.header-right {\n+  position: absolute;\n+  right: 10px;\n+}\n+\n+.content {\n+  display: flex;\n+  flex: 1;\n+  align-items: center;\n+  justify-content: center;\n+  width: 100%;\n+  background-image: url(\"/media/bg/02.jpg\");\n+  background-size: 100% auto;\n+\n+  .box1 {\n+    display: flex;\n+    align-items: center;\n+    justify-content: center;\n+    width: 450px;\n+    height: 600px;\n+    background-color: #fff;\n+\n+    .box2 {\n+      display: flex;\n+      flex-direction: column;\n+      align-items: flex-start;\n+      width: 90%;\n+      height: 90%;\n+      padding: 25px;\n+      border: 1px solid #ebeefe;\n+      border-radius: 4px;\n+\n+      &:hover {\n+        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n+        transition: all 0.4s;\n+      }\n+\n+      h1 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 36px;\n+        font-weight: 400;\n+        color: #666;\n+      }\n+\n+      h4 {\n+        margin-top: 0;\n+        font-family: \"KaiTi\", sans-serif;\n+        /* 添加通用字体族 */\n+        font-size: 18px;\n+        font-weight: 400;\n+        color: #494949;\n+      }\n+\n+      .box3 {\n+        align-self: center;\n+        width: 350px;\n+        height: 300px;\n+        margin-top: 20px;\n+        margin-bottom: 20px;\n+        background-color: #fff;\n+        border: 1px solid #ebeefe;\n+\n+        &:hover {\n+          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n+          transition: all 0.4s;\n+        }\n+      }\n+\n+      el-button {\n+        align-self: center;\n+        /* 水平居中 */\n+        margin-top: 2px;\n+        /* 上下间隔10px */\n+      }\n+    }\n+  }\n+\n+  .login-title {\n+    margin: 20px 0;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-weight: bold;\n+    color: #444;\n+    text-align: center;\n+  }\n+\n+  .login-form {\n+    max-width: 100%;\n+    height: 100%;\n+    padding: 10px 40px 0 10px;\n+    margin-top: 36px;\n+  }\n+\n+  .login-button {\n+    text-align: right;\n+  }\n+\n+  .login-link {\n+    padding: 0 10px;\n+    margin-bottom: 20px;\n+  }\n+\n+  .login-link a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 16px;\n+    color: rgb(28 160 212);\n+  }\n+\n+  .error-message {\n+    margin-top: 10px;\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    color: red;\n+    text-align: center;\n+  }\n+}\n+\n+.footer {\n+  margin: 0 30px;\n+  font-size: 12px;\n+  line-height: 80px;\n+  text-align: center;\n+\n+  .copyright {\n+    position: absolute;\n+    right: 10px;\n+  }\n+\n+  .copyright a {\n+    font-family: \"KaiTi\", sans-serif;\n+    /* 添加通用字体族 */\n+    font-size: 14px;\n+    color: rgb(3 3 3);\n+  }\n+\n+  .copyright a:hover {\n+    color: rgb(11 175 240);\n+  }\n+}\n+\n+.fixed-footer {\n+  position: fixed;\n+  bottom: 0;\n+  z-index: 1;\n+  width: 100%;\n+}\n+</style>\n"
                },
                {
                    "date": 1725418525836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -104,8 +104,9 @@\n     if (valid) {\n       try {\n         const res = await AuthAPI.login(form.value);\n         await initRoutes();\n+        await setupRoutes();\n         await window.location.reload();\n         await succeed(res.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n"
                },
                {
                    "date": 1725422106870,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n import { useUserStore } from \"@/store/modules/user\";\n import { LoginData } from \"@/api/auth/model\";\n import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n import AuthAPI from \"@/api/auth/index\";\n-import { initRoutes, initRoutes } from \"@/router\";\n+import { initRoutes, setupRoutes } from \"@/router\";\n import CryptoJS from \"crypto-js\";\n \n const secretKey = \"bujiaban\"; // 密钥\n \n@@ -104,9 +104,9 @@\n     if (valid) {\n       try {\n         const res = await AuthAPI.login(form.value);\n         await initRoutes();\n-        await setupRoutes();\n+        // await setupRoutes(1);\n         await window.location.reload();\n         await succeed(res.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n@@ -450,456 +450,4 @@\n   z-index: 1;\n   width: 100%;\n }\n </style>\n-<script setup lang=\"ts\">\n-import \"@/assets/font/font.css\";\n-import { ref, computed, nextTick, onMounted } from \"vue\";\n-import { RouterLink, useRouter, LocationQuery, useRoute } from \"vue-router\";\n-import { FormInstance } from \"element-plus\";\n-import { useUserStore } from \"@/store/modules/user\";\n-import { LoginData } from \"@/api/auth/model\";\n-import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n-import AuthAPI from \"@/api/auth/index\";\n-import { initRoutes } from \"@/router\";\n-import CryptoJS from \"crypto-js\";\n-\n-const secretKey = \"bujiaban\"; // 密钥\n-\n-const userStore = useUserStore();\n-const route = useRoute();\n-\n-const form = ref<LoginData>({\n-  username: \"\",\n-  password: \"\",\n-});\n-\n-// 加密\n-const encryptedPassword = (password: string): string => {\n-  return CryptoJS.AES.encrypt(password, secretKey).toString();\n-};\n-// 解密\n-const decryptPassword = (encryptedPassword: string): string => {\n-  const bytes = CryptoJS.AES.decrypt(encryptedPassword, secretKey);\n-  return bytes.toString(CryptoJS.enc.Utf8);\n-};\n-\n-// 保存用户数据到本地\n-const saveLoginData = () => {\n-  const expirationTime = Date.now() + 24 * 60 * 60 * 1000; // 24小时有效\n-  localStorage.setItem(\"username\", form.value.username);\n-  localStorage.setItem(\"password\", encryptedPassword(form.value.password));\n-  localStorage.setItem(\"expirationTime\", expirationTime.toString());\n-};\n-\n-const rules = computed(() => {\n-  return {\n-    username: [\n-      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n-      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n-    ],\n-    password: [\n-      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n-      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n-    ],\n-  };\n-});\n-\n-const router = useRouter();\n-const formRef = ref<FormInstance>();\n-const isShow = ref(false);\n-const title = ref<string | Record<string, string>>(\"\");\n-\n-const succeed = (data: any) => {\n-  ElMessage.success(\"登录成功\");\n-  const token = data.access_token;\n-  if (token) {\n-    setToken(token);\n-    saveLoginData();\n-    const res = localStorage.getItem(TOKEN_KEY);\n-    console.log(\"Token set successfully\", res);\n-    nextTick(() => {\n-      router.push(\"/\");\n-      console.log(\"Routing to home\");\n-    });\n-  } else {\n-    failed(\"登录响应中缺少 access_token\");\n-  }\n-};\n-\n-const setToken = (token: string) => {\n-  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n-};\n-\n-function parseRedirect(): {\n-  path: string;\n-  queryParams: Record<string, string>;\n-} {\n-  const query: LocationQuery = route.query;\n-  const redirect = (query.redirect as string) ?? \"/\";\n-\n-  const url = new URL(redirect, window.location.origin);\n-  const path = url.pathname;\n-  const queryParams: Record<string, string> = {};\n-\n-  url.searchParams.forEach((value, key) => {\n-    queryParams[key] = value;\n-  });\n-\n-  return { path, queryParams };\n-}\n-\n-const failed = (message: any) => {\n-  error(message);\n-};\n-\n-const submit = () => {\n-  formRef.value?.validate(async (valid: boolean) => {\n-    if (valid) {\n-      try {\n-        const res = await AuthAPI.login(form.value);\n-        await initRoutes();\n-        await window.location.reload();\n-        await succeed(res.data);\n-        const userin = await userStore.getUserInfo();\n-        console.log(\"userin:\", userin);\n-        const { path, queryParams } = await parseRedirect();\n-        console.log(\"path:\", path, \"queryParams:\", queryParams);\n-        await router.push({ path: path, query: queryParams });\n-      } catch (error) {\n-        failed(error);\n-      }\n-    } else {\n-      ElMessage({ type: \"error\", message: \"表单校验未通过\" });\n-    }\n-  });\n-};\n-\n-const error = (msg: string | Record<string, string>) => {\n-  title.value =\n-    typeof msg === \"string\"\n-      ? msg\n-      : Object.keys(msg)\n-          .map((key) => `${key} : ${msg[key]}`)\n-          .join(\"\\n\");\n-  isShow.value = true;\n-};\n-\n-onMounted(() => {\n-  const savedUsername = localStorage.getItem(\"username\");\n-  const savedPassword = localStorage.getItem(\"password\");\n-  const savedExpirationTime = localStorage.getItem(\"expirationTime\");\n-\n-  if (savedExpirationTime) {\n-    const expirationTime = parseInt(savedExpirationTime, 10);\n-    if (Date.now() > expirationTime) {\n-      // 密码已过期，清除保存的密码\n-      // localStorage.removeItem(\"username\");\n-      localStorage.removeItem(\"password\");\n-      localStorage.removeItem(\"expirationTime\");\n-    } else {\n-      if (savedUsername) {\n-        form.value.username = savedUsername;\n-      }\n-      if (savedPassword) {\n-        form.value.password = decryptPassword(savedPassword);\n-      }\n-    }\n-  }\n-});\n-</script>\n-\n-<template>\n-  <body>\n-    <div class=\"header\">\n-      <RouterLink to=\"/\" class=\"logo\">\n-        <img src=\"/favicon.ico\" alt=\"\" />\n-        <span class=\"project_title\">苹果AR元气项目</span>\n-      </RouterLink>\n-      <div class=\"header-right\">\n-        <el-button>平台注册/登录</el-button>\n-      </div>\n-      <div class=\"blog\">\n-        <a>开发博客</a>\n-      </div>\n-    </div>\n-    <div class=\"content\">\n-      <div class=\"box1\">\n-        <div class=\"box2\">\n-          <h1>欢迎!</h1>\n-          <h4>准备好出发了么？</h4>\n-          <div class=\"box3\">\n-            <h2 class=\"login-title\">登录账号</h2>\n-            <el-form\n-              ref=\"formRef\"\n-              class=\"login-form\"\n-              :rules=\"rules\"\n-              :model=\"form\"\n-              label-width=\"75px\"\n-            >\n-              <el-form-item label=\"用户名\" prop=\"username\">\n-                <el-input v-model=\"form.username\" suffix-icon=\"User\"></el-input>\n-              </el-form-item>\n-              <el-form-item label=\"密码\" prop=\"password\">\n-                <el-input\n-                  v-model=\"form.password\"\n-                  type=\"password\"\n-                  suffix-icon=\"Lock\"\n-                ></el-input>\n-              </el-form-item>\n-\n-              <el-form-item class=\"login-button\">\n-                <el-button style=\"width: 100%\" type=\"primary\" @click=\"submit\">\n-                  登录平台\n-                </el-button>\n-              </el-form-item>\n-            </el-form>\n-            <!-- <div class=\"login-link\">\n-          <router-link to=\"/site/signup\">\n-            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n-          </router-link>\n-          <br />\n-          <router-link to=\"/site/request-password-reset\">\n-            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n-          </router-link>\n-          <br />\n-        </div> -->\n-            <!-- <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div> -->\n-          </div>\n-          <el-button style=\"width: 100%\" size=\"small\"> 下载相关程序 </el-button>\n-        </div>\n-      </div>\n-    </div>\n-    <div class=\"footer\">\n-      <div class=\"copyright\">\n-        <RouterLink\n-          to=\"https://bujiaban.com\"\n-          target=\"_blank\"\n-          :underline=\"false\"\n-        >\n-          <el-icon>\n-            <HomeFilled></HomeFilled>\n-          </el-icon>\n-          上海不加班网络有限公司(Apple Reality Spirit) |\n-        </RouterLink>\n-        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n-          <el-icon>\n-            <Grid></Grid>\n-          </el-icon>\n-          沪ICP备15039333号 |\n-        </a>\n-        <a href=\"#\">\n-          <el-icon>\n-            <InfoFilled></InfoFilled>\n-          </el-icon>\n-          202408\n-        </a>\n-      </div>\n-    </div>\n-  </body>\n-</template>\n-\n-<style scoped lang=\"scss\">\n-body {\n-  position: fixed;\n-  display: flex;\n-  flex-direction: column;\n-  height: 100%;\n-  margin: 0;\n-}\n-\n-.header,\n-.footer {\n-  position: relative;\n-  display: flex;\n-  align-items: center;\n-  width: 100%;\n-  height: 7%;\n-  margin-right: 10px;\n-  background-color: #f1f1f1;\n-}\n-\n-.logo {\n-  position: absolute;\n-  left: 10px;\n-\n-  img {\n-    width: 32px;\n-    height: 32px;\n-    margin-left: 12px;\n-    vertical-align: middle;\n-  }\n-\n-  .project_title {\n-    margin-left: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    font-weight: 400;\n-    color: #909399;\n-  }\n-}\n-\n-.blog {\n-  position: absolute;\n-  height: 60px;\n-  margin-left: 300px;\n-  font-size: 14px;\n-  font-weight: 400;\n-  line-height: 60px;\n-  color: #909399;\n-\n-  &:hover {\n-    color: #000;\n-  }\n-}\n-\n-.header-right {\n-  position: absolute;\n-  right: 10px;\n-}\n-\n-.content {\n-  display: flex;\n-  flex: 1;\n-  align-items: center;\n-  justify-content: center;\n-  width: 100%;\n-  background-image: url(\"/media/bg/02.jpg\");\n-  background-size: 100% auto;\n-\n-  .box1 {\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-    width: 450px;\n-    height: 600px;\n-    background-color: #fff;\n-\n-    .box2 {\n-      display: flex;\n-      flex-direction: column;\n-      align-items: flex-start;\n-      width: 90%;\n-      height: 90%;\n-      padding: 25px;\n-      border: 1px solid #ebeefe;\n-      border-radius: 4px;\n-\n-      &:hover {\n-        box-shadow: 0 0 10px rgb(0 0 0 / 10%);\n-        transition: all 0.4s;\n-      }\n-\n-      h1 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 36px;\n-        font-weight: 400;\n-        color: #666;\n-      }\n-\n-      h4 {\n-        margin-top: 0;\n-        font-family: \"KaiTi\", sans-serif;\n-        /* 添加通用字体族 */\n-        font-size: 18px;\n-        font-weight: 400;\n-        color: #494949;\n-      }\n-\n-      .box3 {\n-        align-self: center;\n-        width: 350px;\n-        height: 300px;\n-        margin-top: 20px;\n-        margin-bottom: 20px;\n-        background-color: #fff;\n-        border: 1px solid #ebeefe;\n-\n-        &:hover {\n-          box-shadow: 0 0 10px rgb(0 0 0 / 20%);\n-          transition: all 0.4s;\n-        }\n-      }\n-\n-      el-button {\n-        align-self: center;\n-        /* 水平居中 */\n-        margin-top: 2px;\n-        /* 上下间隔10px */\n-      }\n-    }\n-  }\n-\n-  .login-title {\n-    margin: 20px 0;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-weight: bold;\n-    color: #444;\n-    text-align: center;\n-  }\n-\n-  .login-form {\n-    max-width: 100%;\n-    height: 100%;\n-    padding: 10px 40px 0 10px;\n-    margin-top: 36px;\n-  }\n-\n-  .login-button {\n-    text-align: right;\n-  }\n-\n-  .login-link {\n-    padding: 0 10px;\n-    margin-bottom: 20px;\n-  }\n-\n-  .login-link a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 16px;\n-    color: rgb(28 160 212);\n-  }\n-\n-  .error-message {\n-    margin-top: 10px;\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    color: red;\n-    text-align: center;\n-  }\n-}\n-\n-.footer {\n-  margin: 0 30px;\n-  font-size: 12px;\n-  line-height: 80px;\n-  text-align: center;\n-\n-  .copyright {\n-    position: absolute;\n-    right: 10px;\n-  }\n-\n-  .copyright a {\n-    font-family: \"KaiTi\", sans-serif;\n-    /* 添加通用字体族 */\n-    font-size: 14px;\n-    color: rgb(3 3 3);\n-  }\n-\n-  .copyright a:hover {\n-    color: rgb(11 175 240);\n-  }\n-}\n-\n-.fixed-footer {\n-  position: fixed;\n-  bottom: 0;\n-  z-index: 1;\n-  width: 100%;\n-}\n-</style>\n"
                },
                {
                    "date": 1725422118377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n import { useUserStore } from \"@/store/modules/user\";\n import { LoginData } from \"@/api/auth/model\";\n import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n import AuthAPI from \"@/api/auth/index\";\n-import { initRoutes, setupRoutes } from \"@/router\";\n+import { initRoutes } from \"@/router\";\n import CryptoJS from \"crypto-js\";\n \n const secretKey = \"bujiaban\"; // 密钥\n \n"
                },
                {
                    "date": 1725436263292,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -104,9 +104,8 @@\n     if (valid) {\n       try {\n         const res = await AuthAPI.login(form.value);\n         await initRoutes();\n-        // await setupRoutes(1);\n         await window.location.reload();\n         await succeed(res.data);\n         const userin = await userStore.getUserInfo();\n         console.log(\"userin:\", userin);\n"
                },
                {
                    "date": 1725436288359,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,9 +6,9 @@\n import { useUserStore } from \"@/store/modules/user\";\n import { LoginData } from \"@/api/auth/model\";\n import { TOKEN_KEY } from \"@/enums/CacheEnum\";\n import AuthAPI from \"@/api/auth/index\";\n-import { initRoutes } from \"@/router\";\n+//import { initRoutes } from \"@/router\";\n import CryptoJS from \"crypto-js\";\n \n const secretKey = \"bujiaban\"; // 密钥\n \n"
                }
            ],
            "date": 1721119974502,
            "name": "Commit-0",
            "content": "<script setup lang=\"ts\">\nimport { ref, computed } from \"vue\";\nimport { RouterLink, useRouter } from \"vue-router\";\nimport { FormInstance } from \"element-plus\";\nimport { useUserStore } from \"@/store/modules/user\";\nimport { LoginData } from \"@/api/auth/model\";\nimport { TOKEN_KEY } from \"@/enums/CacheEnum\";\n\nconst userStore = useUserStore();\n\nconst form = ref<LoginData>({\n  username: \"huyuelong\",\n  password: \"123456hu\",\n});\n\nconst rules = computed(() => {\n  return {\n    username: [\n      { required: true, message: \"请输入用户名称\", trigger: \"blur\" },\n      { min: 5, message: \"用户名称长度应该大于5\", trigger: \"blur\" },\n    ],\n    password: [\n      { required: true, message: \"请输入密码\", trigger: \"blur\" },\n      { min: 6, message: \"密码长度应该大于6\", trigger: \"blur\" },\n    ],\n  };\n});\n\nconst router = useRouter();\nconst formRef = ref<FormInstance>();\nconst isShow = ref(false);\nconst title = ref<string | Record<string, string>>(\"\");\n\n// 登录成功\nconst succeed = (data: any) => {\n  ElMessage.success(\"登录成功\");\n  console.log(data);\n  const token = data.access_token;\n  console.log(token);\n  if (token) {\n    setToken(token);\n    router.push(\"/\"); // 登录成功后重定向到首页\n  } else {\n    failed(\"登录响应中缺少 access_token\");\n  }\n};\n\n// 设置token\nconst setToken = (token: string) => {\n  localStorage.setItem(TOKEN_KEY, \"Bearer \" + token);\n};\n\n// 登录失败\nconst failed = (message: any) => {\n  error(message);\n};\n\n// 提交登录表单\nfunction submit() {\n  formRef.value?.validate((valid: boolean) => {\n    if (valid) {\n      userStore\n        .login(form.value)\n        .then((data) => {\n          succeed(data);\n        })\n        .catch((error) => {\n          failed(error);\n        });\n    }\n  });\n}\n// const submit = () => {\n//   formRef.value?.validate(async (valid: boolean) => {\n//     if (valid) {\n//       const res = await AuthAPI.login(form.value);\n//       console.log(\"res:\", res.data.access_token);\n//     }\n//   });\n// };\n\n// 显示错误信息\nconst error = (msg: string | Record<string, string>) => {\n  title.value =\n    typeof msg === \"string\"\n      ? msg\n      : Object.keys(msg)\n          .map((key) => `${key} : ${msg[key]}`)\n          .join(\"\\n\");\n  isShow.value = true;\n};\n</script>\n\n<template>\n  <body>\n    <div class=\"header\">\n      <RouterLink to=\"/\" class=\"logo\">\n        <img src=\"/public/favicon.ico\" alt=\"\" />\n        <span class=\"project_title\">苹果AR元气项目</span>\n      </RouterLink>\n      <div class=\"header-right\">\n        <el-button>平台注册/登录</el-button>\n      </div>\n      <div class=\"blog\">\n        <a>开发博客</a>\n      </div>\n    </div>\n    <div class=\"content\">\n      <div>\n        <h2 class=\"login-title\">登录账号</h2>\n        <el-form\n          ref=\"formRef\"\n          class=\"login-body\"\n          :rules=\"rules\"\n          :model=\"form\"\n          label-width=\"75px\"\n        >\n          <el-form-item label=\"用户名\" prop=\"username\">\n            <el-input v-model=\"form.username\" suffix-icon=\"User\" />\n          </el-form-item>\n          <el-form-item label=\"密码\" prop=\"password\">\n            <el-input\n              v-model=\"form.password\"\n              type=\"password\"\n              suffix-icon=\"Lock\"\n            />\n          </el-form-item>\n\n          <el-form-item class=\"login-button\">\n            <el-button style=\"width: 120px\" type=\"primary\" @click=\"submit\">\n              进入\n            </el-button>\n          </el-form-item>\n        </el-form>\n        <div class=\"login-link\">\n          <router-link to=\"/site/signup\">\n            <el-link type=\"primary\" :underline=\"false\">注册用户</el-link>\n          </router-link>\n          <br />\n          <router-link to=\"/site/request-password-reset\">\n            <el-link type=\"primary\" :underline=\"false\">找回密码</el-link>\n          </router-link>\n          <br />\n        </div>\n        <div v-if=\"isShow\" class=\"error-message\">{{ title }}</div>\n      </div>\n    </div>\n    <div class=\"footer\">\n      <div class=\"copyright\">\n        <RouterLink\n          to=\"https://bujiaban.com\"\n          target=\"_blank\"\n          :underline=\"false\"\n        >\n          <el-icon><HomeFilled /></el-icon>\n          上海不加班网络有限公司(Apple Reality Spirit)\n        </RouterLink>\n        <!-- <br> -->\n        <a href=\"https://beian.miit.gov.cn/\" target=\"_blank\" :underline=\"false\">\n          <el-icon><Document /></el-icon>\n          沪ICP备15039333号\n        </a>\n        <a href=\"#\">\n          <el-icon><InfoFilled /></el-icon>\n          2024\n        </a>\n      </div>\n    </div>\n  </body>\n</template>\n\n<style scoped lang=\"scss\">\nbody {\n  height: 100%;\n  margin: 0;\n  position: fixedg;\n}\n\nbody {\n  display: flex;\n  flex-direction: column;\n}\n\n.header,\n.footer {\n  height: 7%;\n  width: 100%;\n  background-color: #f1f1f1;\n  position: relative;\n  display: flex;\n  align-items: center;\n  margin-right: 10px;\n}\n\n.logo {\n  position: absolute;\n  left: 10px;\n  img {\n    width: 32px;\n    height: 32px;\n    vertical-align: middle;\n    margin-left: 12px;\n  }\n  .project_title {\n    margin-left: 10px;\n    color: #909399;\n    font-size: 14px;\n    font-family: \"SourceHanSansSC-VF\";\n    font-weight: 400;\n  }\n}\n\n.blog {\n  position: absolute;\n  margin-left: 300px;\n  height: 60px;\n  line-height: 60px;\n  color: #909399;\n  font-size: 14px;\n  font-family: \"SourceHanSansSC-VF\";\n  font-weight: 400;\n  &:hover {\n    color: #000000;\n  }\n}\n\n.header-right {\n  position: absolute;\n  right: 10px;\n}\n\n.content {\n  flex: 1;\n  width: 100%;\n  background-image: url(\"/public/media/bg/02.jpg\");\n  background-size: 100% auto;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  .login-title {\n    margin: 20px 0;\n    font-weight: bold;\n    color: #444;\n    text-align: center;\n  }\n\n  .login-body {\n    max-width: 100%;\n    height: 100%;\n    padding: 10px 40px 0 10px;\n    margin-top: 36px;\n  }\n\n  .login-button {\n    text-align: right;\n  }\n\n  .login-link {\n    padding: 0 10px;\n    margin-bottom: 20px;\n  }\n\n  .login-link a {\n    font-size: 16px;\n    color: rgb(28 160 212);\n  }\n\n  .error-message {\n    margin-top: 10px;\n    color: red;\n    text-align: center;\n  }\n}\n\n.footer {\n  text-align: center;\n  font-size: 12px;\n  margin: 0 30px;\n  line-height: 80px;\n  .copyright {\n    position: absolute;\n    right: 10px;\n  }\n  .copyright a {\n    color: rgb(3, 3, 3);\n    padding: 0 20px;\n    font-size: 14px;\n  }\n  .copyright a:hover {\n    color: rgb(11, 175, 240);\n  }\n}\n.fixed-footer {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  z-index: 1;\n}\n</style>\n"
        }
    ]
}